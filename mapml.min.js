/*! web-map-custom-element 17-08-2020 */

!function(){"use strict";const t=256,e="OSMTILE";var i=L.GridLayer.extend({initialize:function(t){this.zoomBounds=this._getZoomBounds(t.tileContainer,t.maxZoomBound),L.extend(t,this.zoomBounds),L.setOptions(this,t),this._groups=this._groupTiles(this.options.tileContainer.getElementsByTagName("tile"))},onAdd:function(){this._bounds=this._getLayerBounds(this._groups,this._map.options.projection),this.layerBounds=this._bounds[Object.keys(this._bounds)[0]];for(let t of Object.keys(this._bounds))this.layerBounds.extend(this._bounds[t].min),this.layerBounds.extend(this._bounds[t].max);L.GridLayer.prototype.onAdd.call(this,this._map),this._map.fire("moveend",!0)},getEvents:function(){let t=L.GridLayer.prototype.getEvents.call(this,this._map);return this._parentOnMoveEnd=t.moveend,t.moveend=this._handleMoveEnd,t.move=(()=>{}),t},_handleMoveEnd:function(t){let e=this._map.getZoom(),i=e;i=(i=i>this.options.maxNativeZoom?this.options.maxNativeZoom:i)<this.options.minNativeZoom?this.options.minNativeZoom:i,this.isVisible=e<=this.zoomBounds.maxZoom&&e>=this.zoomBounds.minZoom&&this._bounds[i]&&this._bounds[i].overlaps(M.pixelToPCRSBounds(this._map.getPixelBounds(),this._map.getZoom(),this._map.options.projection)),this.isVisible&&this._parentOnMoveEnd()},_isValidTile(t){return this._groups[this._tileCoordsToKey(t)]},createTile:function(t){let e=this._groups[this._tileCoordsToKey(t)]||[],i=document.createElement("tile");i.setAttribute("col",t.x),i.setAttribute("row",t.y),i.setAttribute("zoom",t.z);for(let t=0;t<e.length;t++){let o=document.createElement("img");o.src=e[t].src,i.appendChild(o)}return i},_getLayerBounds:function(e,i){let o={};for(let i in e){let e=i.split(":"),n={};n.x=+e[0]*t,n.y=+e[1]*t,n.z=+e[2],e[2]in o?(o[e[2]].extend(L.point(n.x,n.y)),o[e[2]].extend(L.point(n.x+t,n.y+t))):o[e[2]]=L.bounds(L.point(n.x,n.y),L.point(n.x+t,n.y+t))}for(let t in o){let e=+t;o[t]=M.pixelToPCRSBounds(o[t],e,i)}return o},_getZoomBounds:function(t,e){if(!t)return null;let i=M.metaContentToObject(t.getElementsByTagName("tiles")[0].getAttribute("zoom")),o={},n=t.getElementsByTagName("tile");o.maxNativeZoom=0,o.minNativeZoom=e;for(let t=0;t<n.length;t++)n[t].getAttribute("zoom")&&(+n[t].getAttribute("zoom")>o.maxNativeZoom&&(o.maxNativeZoom=+n[t].getAttribute("zoom")),+n[t].getAttribute("zoom")<o.minNativeZoom&&(o.minNativeZoom=+n[t].getAttribute("zoom")));return o.minZoom=o.minNativeZoom-2<=0?0:o.minNativeZoom-2,o.maxZoom=e,i.min&&(o.minZoom=+i.min<o.minNativeZoom-2?o.minNativeZoom-2:+i.min),i.max&&(o.maxZoom=+i.max),o},_groupTiles:function(t){let e={};for(let i=0;i<t.length;i++){let o={};o.row=+t[i].getAttribute("row"),o.col=+t[i].getAttribute("col"),o.zoom=+t[i].getAttribute("zoom")||0,o.src=t[i].getAttribute("src");let n=o.col+":"+o.row+":"+o.zoom;n in e?e[n].push(o):e[n]=[o]}return e}}),o=function(t){return new i(t)},n=L.Control.Layers.extend({options:{autoZIndex:!1,sortLayers:!0,sortFunction:function(t,e){return t.options.zIndex<e.options.zIndex?-1:t.options.zIndex>e.options.zIndex?1:0}},initialize:function(t,e){for(var i in L.setOptions(this,e),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,t)this._addLayer(t[i],i,!0)},onAdd:function(){return this._initLayout(),this._map.on("moveend",this._validateExtents,this),this._update(),this._container},onRemove:function(t){t.off("moveend",this._validateExtents,this);for(var e=0;e<this._layers.length;e++)this._layers[e].layer.off("add remove",this._onLayerChange,this),this._layers[e].layer.off("extentload",this._validateExtents,this)},addOrUpdateOverlay:function(t,e){for(var i=!1,o=0;o<this._layers.length;o++)if(this._layers[o].layer===t){i=!0,this._layers[o].name=e;break}return i||this.addOverlay(t,e),this._map?this._update():this},_validateExtents:function(t){setTimeout(()=>{let t,i=["_staticTileLayer","_imageLayer","_mapmlvectors","_templatedLayer"];for(let o=0;o<this._layers.length;o++){let n=0,a=0;if((t=this._layers[o].layer._extent?this._layers[o].layer._extent.getAttribute("units")||this._layers[o].layer._extent.getAttribute("content")||this._layers[o].layer._extent.querySelector("input[type=projection]").getAttribute("value"):e)&&t!==this._map.options.projection)n=1,a=1;else for(let t=0;t<i.length;t++){let e=i[t];if(this._layers[o].input.checked&&this._layers[o].layer[e])if("_templatedLayer"===e)for(let t=0;t<this._layers[o].layer[e]._templates.length;t++)"query"!==this._layers[o].layer[e]._templates[t].rel&&(a++,this._layers[o].layer[e]._templates[t].layer.isVisible||n++);else a++,this._layers[o].layer[e].isVisible||n++}let r=this._layers[o].input.labels[0].getElementsByTagName("span"),s=this._layers[o].input.labels[0].getElementsByTagName("input");n===a&&0!==n?(this._layers[o].layer._layerEl.setAttribute("disabled",""),s[0].parentElement.parentElement.parentElement.parentElement.disabled=!0,r[0].style.fontStyle="italic"):(this._layers[o].layer._layerEl.removeAttribute("disabled"),s[0].parentElement.parentElement.parentElement.parentElement.disabled=!1,r[0].style.fontStyle="normal")}},0)},_withinZoomBounds:function(t,e){return e.min<=t&&t<=e.max},_addItem:function(t){var e=t.layer.getLayerUserControlsHTML();return t.input=e.querySelector("input"),this._layerControlInputs.push(t.input),t.input.layerId=L.stamp(t.layer),L.DomEvent.on(t.input,"click",this._onInputClick,this),t.layer.on("extentload",this._validateExtents,this),this._overlaysList.appendChild(e),e}}),a=function(t,e){return new n(t,e)},r=L.FeatureGroup.extend({initialize:function(t,e){L.setOptions(this,e),this._container=L.DomUtil.create("div","leaflet-layer",this.options.pane),L.DomUtil.addClass(this._container,"leaflet-pane mapml-vector-container"),L.setOptions(this.options.renderer,{pane:this._container}),this._layers={},t&&(!t.querySelector("extent")&&t.querySelector("feature")&&(this._features={},this._staticFeature=!0,this.isVisible=!0,this.nativeZoom=+this._getNativeZoom(t),this.zoomBounds=this._getZoomBounds(t),this.layerBounds=this._getLayerBounds(t),L.extend(this.options,this.zoomBounds)),this.addData(t),this._staticFeature&&(this._resetFeatures(this._clampZoom(this.options._leafletLayer._map.getZoom())),this.options._leafletLayer._map._addZoomLimit(this)))},getEvents:function(){return this._staticFeature?{moveend:this._handleMoveEnd}:{moveend:this._removeCSS}},_handleMoveEnd:function(){let t=this._map.getZoom();if(t>this.zoomBounds.maxZoom||t<this.zoomBounds.minZoom)return this.clearLayers(),void(this.isVisible=!1);let e=this._clampZoom(t);this._resetFeatures(e),this.isVisible=this._layers&&this.layerBounds&&this.layerBounds.overlaps(M.pixelToPCRSBounds(this._map.getPixelBounds(),t,this._map.options.projection)),this._removeCSS()},_getLayerBounds:function(t){if(!t)return null;try{let i=t.querySelector("meta[name=projection]")&&M.metaContentToObject(t.querySelector("meta[name=projection]").getAttribute("content")).content.toUpperCase()||e,o=this._getNativeZoom(t),n=t.querySelector("meta[name=extent]")&&M.metaContentToObject(t.querySelector("meta[name=extent]").getAttribute("content"))||{"top-left-vertical":0,"top-left-horizontal":0,"bottom-right-vertical":5,"bottom-right-horizontal":5},a=n.cs||"TILEMATRIX";return M.boundsToPCRSBounds(L.bounds(L.point(+n["top-left-vertical"],+n["top-left-horizontal"]),L.point(+n["bottom-right-vertical"],+n["bottom-right-horizontal"])),o,i,a)}catch(t){return M.boundsToPCRSBounds(M[e].options.crs.tilematrix.bounds(0),0,e,"TILEMATRIX")}},_resetFeatures:function(t){if(this.clearLayers(),this._features&&this._features[t])for(let e=0;e<this._features[t].length;e++)this.addLayer(this._features[t][e])},_clampZoom:function(t){return t>this.zoomBounds.maxZoom||t<this.zoomBounds.minZoom?t:void 0!==this.zoomBounds.minNativeZoom&&t<this.zoomBounds.minNativeZoom?this.zoomBounds.minNativeZoom:void 0!==this.zoomBounds.maxNativeZoom&&this.zoomBounds.maxNativeZoom<t?this.zoomBounds.maxNativeZoom:t},_setZoomTransform:function(t,e){var i=this._map.getZoomScale(this._map.getZoom(),e),o=t.multiplyBy(i).subtract(this._map._getNewPixelOrigin(t,this._map.getZoom())).round();any3d?L.setTransform(this._layers[e],o,i):L.setPosition(this._layers[e],o)},_getNativeZoom:function(t){return t.querySelector("meta[name=zoom]")&&M.metaContentToObject(t.querySelector("meta[name=zoom]").getAttribute("content")).value||"0"},_getZoomBounds:function(t){if(!t)return null;let i,o,n=100,a=0,r=t.getElementsByTagName("feature");for(let t=0;t<r.length;t++)r[t].getAttribute("zoom")&&(+r[t].getAttribute("zoom")>a&&(a=+r[t].getAttribute("zoom")),+r[t].getAttribute("zoom")<n&&(n=+r[t].getAttribute("zoom")));try{o=M.metaContentToObject(t.querySelector("meta[name=projection]").getAttribute("content")).content,i=M.metaContentToObject(t.querySelector("meta[name=zoom]").getAttribute("content"))}catch(t){return{minZoom:0,maxZoom:M[o||e].options.resolutions.length-1,minNativeZoom:n,maxNativeZoom:a}}return{minZoom:+i.min,maxZoom:+i.max,minNativeZoom:n,maxNativeZoom:a}},addData:function(t){var e,i,o,n=t.nodeType===Node.DOCUMENT_NODE||"LAYER-"===t.nodeName?t.getElementsByTagName("feature"):null;if(t.nodeType===Node.DOCUMENT_NODE?t.querySelector("link[rel=stylesheet],style"):null){var a=t.querySelector("base")&&t.querySelector("base").hasAttribute("href")?new URL(t.querySelector("base").getAttribute("href")).href:t.URL;M.parseStylesheetAsHTML(t,a,this._container)}if(n){for(e=0,i=n.length;e<i;e++){(o=n[e]).getElementsByTagName("geometry").length&&o.getElementsByTagName("coordinates").length&&this.addData(o)}return this}var r=this.options;if(!r.filter||r.filter(t)){t.classList.length&&(r.className=t.classList.value);var s=this.geometryToLayer(t,r.pointToLayer,r.coordsToLatLng,r);if(s){if(s.properties=t.getElementsByTagName("properties")[0],!s.options.color&&t.hasAttribute("class")&&(s.options.className=t.getAttribute("class")),s.defaultOptions=s.options,this.resetStyle(s),r.onEachFeature&&r.onEachFeature(s.properties,s),this._staticFeature){let e=t.getAttribute("zoom")||this.nativeZoom;return void(e in this._features?this._features[e].push(s):this._features[e]=[s])}return this.addLayer(s)}}},resetStyle:function(t){var e=this.options.style;e&&(L.Util.extend(t.options,t.defaultOptions),this._setLayerStyle(t,e))},setStyle:function(t){this.eachLayer(function(e){this._setLayerStyle(e,t)},this)},_setLayerStyle:function(t,e){"function"==typeof e&&(e=e(t.feature)),t.setStyle&&t.setStyle(e)},_removeCSS:function(){let t=this._container.querySelectorAll("link[rel=stylesheet],style");for(let e=0;e<t.length;e++)this._container.removeChild(t[e])},geometryToLayer:function(t,e,i,o){var n,a,r,s,l,m,u="FEATURE"===t.tagName.toUpperCase()?t.getElementsByTagName("geometry")[0]:t;i=i||this.coordsToLatLng;var c={opacity:o.opacity?o.opacity:null,icon:L.icon({iconUrl:o.imagePath+"marker-icon.png",iconRetinaUrl:o.imagePath+"marker-icon-2x.png",shadowUrl:o.imagePath+"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]})};switch(u.firstElementChild.tagName.toUpperCase()){case"POINT":return r=[],u.getElementsByTagName("coordinates")[0].textContent.split(/\s+/gim).forEach(M.parseNumber,r),n=i(r),e?e(t,n):new L.Marker(n,c);case"MULTIPOINT":r=[],u.getElementsByTagName("coordinates")[0].textContent.match(/(\S+ \S+)/gim).forEach(M.splitCoordinate,r),a=this.coordsToLatLngs(r,0,i);var h=new Array(a.length);for(s=0;s<h.length;s++)h[s]=new L.Marker(a[s],c);return new L.featureGroup(h);case"LINESTRING":return r=[],u.getElementsByTagName("coordinates")[0].textContent.match(/(\S+ \S+)/gim).forEach(M.splitCoordinate,r),a=this.coordsToLatLngs(r,0,i),new L.Polyline(a,o);case"MULTILINESTRING":for(l=u.getElementsByTagName("coordinates"),m=new Array(l.length),s=0;s<l.length;s++)m[s]=g(l[s]);return a=this.coordsToLatLngs(m,2,i),new L.Polyline(a,o);case"POLYGON":var p=u.getElementsByTagName("coordinates");return a=this.coordsToLatLngs(g(p),1,i),new L.Polygon(a,o);case"MULTIPOLYGON":l=u.getElementsByTagName("polygon");var d=new Array(l.length);for(s=0;s<l.length;s++)d[s]=g(l[s].querySelectorAll("coordinates"));return a=this.coordsToLatLngs(d,2,i),new L.Polygon(a,o);case"GEOMETRYCOLLECTION":console.log("GEOMETRYCOLLECTION Not implemented yet");break;default:console.log("Invalid GeoJSON object.")}function g(t){for(var e=new Array(t.length),i=0;i<e.length;i++)e[i]=[],(t[i]||t).textContent.match(/(\S+\s+\S+)/gim).forEach(M.splitCoordinate,e[i]);return e}},coordsToLatLng:function(t){return new L.LatLng(t[1],t[0],t[2])},coordsToLatLngs:function(t,e,i){var o,n,a,r=[];for(n=0,a=t.length;n<a;n++)o=e?this.coordsToLatLngs(t[n],e-1,i):(i||this.coordsToLatLng)(t[n]),r.push(o);return r}}),s=function(t,e){return new r(t,e)},l=L.TileLayer.extend({initialize:function(t,e){let i=M.extractInputBounds(t);this.zoomBounds=i.zoomBounds,this.layerBounds=i.bounds,this.isVisible=!0,L.extend(e,this.zoomBounds),L.setOptions(this,e),this._setUpTileTemplateVars(t),t.tile.subdomains&&L.setOptions(this,L.extend(this.options,{subdomains:t.tile.subdomains})),this._template=t,this._initContainer(),L.TileLayer.prototype.initialize.call(this,t.template,L.extend(e,{pane:this._container}))},onAdd:function(){this._map._addZoomLimit(this),L.TileLayer.prototype.onAdd.call(this,this._map),this._map.fire("moveend",!0)},getEvents:function(){let t=L.TileLayer.prototype.getEvents.call(this,this._map);return this._parentOnMoveEnd=t.moveend,t.moveend=this._handleMoveEnd,t},_initContainer:function(){this._container||(this._container=L.DomUtil.create("div","leaflet-layer",this.options.pane),L.DomUtil.addClass(this._container,"mapml-templated-tile-container"),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity())},_handleMoveEnd:function(t){let e=this._map.getZoom(),i=M.pixelToPCRSBounds(this._map.getPixelBounds(),e,this._map.options.projection);this.isVisible=e<=this.options.maxZoom&&e>=this.options.minZoom&&this.layerBounds.overlaps(i),this.isVisible&&this._parentOnMoveEnd()},createTile:function(e){if(this._template.type.startsWith("image/"))return L.TileLayer.prototype.createTile.call(this,e,function(){});var i=document.createElementNS("http://www.w3.org/2000/svg","svg");return i.setAttribute("width",`${t}`),i.setAttribute("height",`${t}`),L.DomUtil.addClass(i,"leaflet-tile"),this._fetchTile(e,i),i},_mapmlTileReady:function(t){L.DomUtil.addClass(t,"leaflet-tile-loaded")},getPane:function(){return this.options.pane},_drawTile:function(t,e,i){if(t.querySelector("link[rel=stylesheet],style")){var o=t.querySelector("base")&&t.querySelector("base").hasAttribute("href")?new URL(t.querySelector("base").getAttribute("href")).href:t.URL;M.parseStylesheetAsHTML(t,o,i)}for(var n=t.querySelectorAll("feature"),a=0;a<n.length;a++)this._draw(n[a],e,i);this._mapmlTileReady(i)},_draw:function(e,i,o){var n,a,r,s="FEATURE"===e.tagName.toUpperCase()?e.getElementsByTagName("geometry")[0]:e,l=this.options.crs;switch(e.classList.add("_"+e.id.substring(e.id.indexOf(".")+1)),e.classList.forEach(t=>s.classList.add(t)),s.firstElementChild.tagName.toUpperCase()){case"POINT":n=[],s.getElementsByTagName("coordinates")[0].textContent.split(/\s+/gim).forEach(M.parseNumber,n),h(this.coordsToPoint(n,i),s);break;case"MULTIPOINT":for(n=[],s.getElementsByTagName("coordinates")[0].textContent.match(/(\S+ \S+)/gim).forEach(M.splitCoordinate,n),r=this.coordsToPoints(n,0,i),a=0;a<r.length;a++){const t=s;e.classList.forEach(e=>t.getElementsByTagName("coordinates")[0].classList.add(e)),h(r[a],t.getElementsByTagName("coordinates")[0])}break;case"LINESTRING":n=[],s.getElementsByTagName("coordinates")[0].textContent.match(/(\S+ \S+)/gim).forEach(M.splitCoordinate,n),c(this.coordsToPoints(n,0,i),s);break;case"MULTILINESTRING":for(r=s.getElementsByTagName("coordinates"),a=0;a<r.length;a++){n=[];const t=r[a];e.classList.forEach(e=>t.classList.add(e)),t.textContent.match(/(\S+ \S+)/gim).forEach(M.splitCoordinate,n),c(this.coordsToPoints(n,0,i),s)}break;case"POLYGON":m(this.coordsToPoints(p(s.getElementsByTagName("coordinates")),1,i),s);break;case"MULTIPOLYGON":for(r=s.getElementsByTagName("polygon"),a=0;a<r.length;a++){const t=r[a];e.classList.forEach(e=>t.classList.add(e)),m(this.coordsToPoints(p(t.getElementsByTagName("coordinates")),1,i),t)}break;case"GEOMETRYCOLLECTION":console.log("GEOMETRYCOLLECTION Not implemented yet");break;default:console.log("Invalid geometry")}function m(t,e){for(var i=document.createElementNS("http://www.w3.org/2000/svg","path"),n="",a=0;a<t.length;a++){n=n+"M "+Math.round(t[a][0].x)+","+Math.round(t[a][0].y)+" ";for(var r=1;r<t[a].length;r++)n=n+Math.round(t[a][r].x)+","+Math.round(t[a][r].y)+" "}(i.setAttribute("d",n),e.classList.forEach(t=>i.classList.add(t)),i.style.display="none",o.appendChild(i),"none"!==window.getComputedStyle(i).stroke)&&(e.querySelector("coordinates span")&&(i.style.stroke="none",function(t,e){for(var i=0;i<t.length;i++){const o=NodeFilter;u(document.createTreeWalker(t[i],o.SHOW_ELEMENT+o.SHOW_TEXT,{acceptNode:function(t){if(t.nodeType===Node.ELEMENT_NODE)return o.FILTER_ACCEPT;return t.nodeType===Node.TEXT_NODE&&/(\S+ \S+)/gim.test(t.data)?o.FILTER_ACCEPT:o.FILTER_REJECT}}),e)}}(e.querySelectorAll("coordinates"),e.classList)));i.style.display=""}function u(t,e){var n,a,r=[];for(n=t.currentNode;n;n=t.nextNode()){const t=n;t.nodeType===Node.TEXT_NODE?r.push(p([t])[0]):e.forEach(e=>t.classList.add(e))}for(t.currentNode=t.root,n=t.currentNode,a=0;n;n=t.nextNode()){var s=t.currentNode;if(n.nodeType===Node.TEXT_NODE){var l=t.parentNode();t.currentNode=s;var m=t.nextNode();t.currentNode=s;var u=t.previousSibling();if(t.currentNode=s,l&&"coordinates"===l.nodeName){if(u&&"span"===u.nodeName){var c=r[a-1].length-1;r[a].unshift(r[a-1][c])}m&&"span"===m.nodeName&&r[a].push(r[a+1][0])}var h=d(r[a],i);const e=document.createElementNS("http://www.w3.org/2000/svg","path");for(var g="M ",y=0;y<h.length;y++)g+=Math.round(h[y].x)+","+Math.round(h[y].y)+" ";e.setAttribute("d",g),l.classList.forEach(t=>e.classList.add(t)),e.classList.add("span"),o.appendChild(e),a++}}}function c(t,e){if(e.querySelector("coordinates span"));else{var i=document.createElementNS("http://www.w3.org/2000/svg","path"),n="";n=n+"M "+Math.round(t[0].x)+","+Math.round(t[0].y)+" ";for(var a=1;a<t.length;a++)n=n+Math.round(t[a].x)+","+Math.round(t[a].y)+" ";i.setAttribute("d",n),e.classList.forEach(t=>i.classList.add(t)),i.classList.add("linestring"),o.appendChild(i)}}function h(t,e){var i=document.createElementNS("http://www.w3.org/2000/svg","circle");i.setAttribute("cx",Math.round(t.x)),i.setAttribute("cy",Math.round(t.y)),i.setAttribute("r","5"),e.classList.forEach(t=>i.classList.add(t)),o.appendChild(i)}function p(t){for(var e=new Array(t.length),i=0;i<e.length;i++)e[i]=[],(t[i]||t).textContent.match(/(\S+\s+\S+)/gim).forEach(M.splitCoordinate,e[i]);return e}function d(t,e){var i,o,n,a=[];for(o=0,n=t.length;o<n;o++)i=g(t[o],e),a.push(i);return a}function g(e,i){return function(e,i){var o=l.transformation.transform(e,l.scale(i.z));return L.point(o.x-i.x*t,o.y-i.y*t)}(L.point(e[0],e[1]),i)}},coordsToLatLng:function(t){return new L.LatLng(t[1],t[0],t[2])},pcrs2tile:function(e,i){var o=this.options.crs,n=o.transformation.transform(e,o.scale(i.z));return L.point(n.x-i.x*t,n.y-i.y*t)},coordsToPoint:function(t,e){return this.pcrs2tile(L.point(t[0],t[1]),e)},coordsToPoints:function(t,e,i){var o,n,a,r=[];for(n=0,a=t.length;n<a;n++)o=e?this.coordsToPoints(t[n],e-1,i):this.coordsToPoint(t[n],i),r.push(o);return r},coordsToPointsDBG:function(t,e,i){var o,n,a,r=[];for(n=0,a=t.length;n<a;n++)o=e?this.coordsToPointsDBG(t[n],e-1,i):o=L.point(t[n][0],t[n][1]),r.push(o);return r},_fetchTile:function(t,e){fetch(this.getTileUrl(t),{redirect:"follow"}).then(function(t){return t.status>=200&&t.status<300?Promise.resolve(t):(console.log("Looks like there was a problem. Status Code: "+t.status),Promise.reject(t))}).then(function(t){return t.text()}).then(t=>{return(new DOMParser).parseFromString(t,"application/xml")}).then(i=>{this._drawTile(i,t,e)}).catch(function(t){})},getTileUrl:function(t){if(t.z>=this._template.tilematrix.bounds.length||!this._template.tilematrix.bounds[t.z].contains(t))return"";var e={};for(var i in e[this._template.tilematrix.col.name]=t.x,e[this._template.tilematrix.row.name]=t.y,e[this._template.zoom.name]=this._getZoomForUrl(),e[this._template.pcrs.easting.left]=this._tileMatrixToPCRSPosition(t,"top-left").x,e[this._template.pcrs.easting.right]=this._tileMatrixToPCRSPosition(t,"top-right").x,e[this._template.pcrs.northing.top]=this._tileMatrixToPCRSPosition(t,"top-left").y,e[this._template.pcrs.northing.bottom]=this._tileMatrixToPCRSPosition(t,"bottom-left").y,e[this._template.tile.server]=this._getSubdomain(t),this._template.tile)["row","col","zoom","left","right","top","bottom"].indexOf(i)<0&&(e[i]=this._template.tile[i]);return e.r=this.options.detectRetina&&L.Browser.retina&&this.options.maxZoom>0?"@2x":"",L.Util.template(this._url,e)},_tileMatrixToPCRSPosition:function(t,e){var i=this._map.options.crs,o=this.getTileSize(),n=t.scaleBy(o),a=n.add(o),r=n.add(Math.floor(o/2)),s=i.transformation.untransform(n,i.scale(t.z)),l=i.transformation.untransform(a,i.scale(t.z)),m=i.transformation.untransform(r,i.scale(t.z)),u=null;switch(e){case"top-left":u=s;break;case"bottom-left":u=new L.Point(s.x,l.y);break;case"center-left":u=new L.Point(s.x,m.y);break;case"top-right":u=new L.Point(l.x,s.y);break;case"bottom-right":u=l;break;case"center-right":u=new L.Point(l.x,m.y);break;case"top-center":u=new L.Point(m.x,s.y);break;case"bottom-center":u=new L.Point(m.x,l.y);break;case"center":u=m}return u},_setUpTileTemplateVars:function(e){e.tile={};for(var i,o,n,a,r,s=e.values,l=this.options.crs.options,m=0;m<e.values.length;m++){var u=s[m].getAttribute("type"),c=s[m].getAttribute("units"),h=s[m].getAttribute("axis"),p=s[m].getAttribute("name"),d=s[m].getAttribute("position"),g="hidden"===u&&s[m].hasAttribute("shard"),y="select"===s[m].tagName.toLowerCase(),x=s[m].getAttribute("value"),_=s[m].getAttribute("min"),f=s[m].getAttribute("max");if("location"===u&&"tilematrix"===c)switch(h){case"column":r={name:p,min:l.crs.tilematrix.horizontal.min,max:l.crs.tilematrix.horizontal.max(l.resolutions.length-1)},isNaN(Number.parseInt(_,10))||(r.min=Number.parseInt(_,10)),isNaN(Number.parseInt(f,10))||(r.max=Number.parseInt(f,10));break;case"row":a={name:p,min:l.crs.tilematrix.vertical.min,max:l.crs.tilematrix.vertical.max(l.resolutions.length-1)},isNaN(Number.parseInt(_,10))||(a.min=Number.parseInt(_,10)),isNaN(Number.parseInt(f,10))||(a.max=Number.parseInt(f,10));break;case"longitude":case"easting":o||(o={min:l.crs.pcrs.horizontal.min,max:l.crs.pcrs.horizontal.max}),isNaN(Number.parseFloat(_))||(o.min=Number.parseFloat(_)),isNaN(Number.parseFloat(f))||(o.max=Number.parseFloat(f)),d&&(d.match(/.*?-left/i)?o.left=p:d.match(/.*?-right/i)&&(o.right=p));break;case"latitude":case"northing":n||(n={min:l.crs.pcrs.vertical.min,max:l.crs.pcrs.vertical.max}),isNaN(Number.parseFloat(_))||(n.min=Number.parseFloat(_)),isNaN(Number.parseFloat(f))||(n.max=Number.parseFloat(f)),d&&(d.match(/top-.*?/i)?n.top=p:d.match(/bottom-.*?/i)&&(n.bottom=p))}else if("zoom"===u.toLowerCase())i={name:p,min:0,max:l.resolutions.length,value:l.resolutions.length},!isNaN(Number.parseInt(x,10))&&Number.parseInt(x,10)>=i.min&&Number.parseInt(x,10)<=i.max?i.value=Number.parseInt(x,10):i.value=i.max,!isNaN(Number.parseInt(_,10))&&Number.parseInt(_,10)>=i.min&&Number.parseInt(_,10)<=i.max&&(i.min=Number.parseInt(_,10)),!isNaN(Number.parseInt(f,10))&&Number.parseInt(f,10)>=i.min&&Number.parseInt(f,10)<=i.max&&(i.max=Number.parseInt(f,10)),e.zoom=i;else if(g)e.tile.server=p,e.tile.subdomains=s[m].servers.slice();else if(y){const t=s[m].htmlselect;e.tile[p]=function(){return t.value}}else{const t=s[m];e.tile[p]=function(){return t.getAttribute("value")}}}var b=this.options.crs.transformation,v=L.bind(this.options.crs.scale,this.options.crs),T=function(e,i){return b.untransform(e.multiplyBy(t),v(i))},E=function(e,i){return b.transform(e,v(i)).divideBy(t).floor()};o&&n?(e.pcrs={},e.pcrs.bounds=L.bounds([o.min,n.min],[o.max,n.max]),e.pcrs.easting=o,e.pcrs.northing=n):r&&a&&!isNaN(i.value)?(e.pcrs||(e.pcrs={},e.pcrs.easting="",e.pcrs.northing=""),e.pcrs.bounds=L.bounds(T(L.point([r.min,a.min]),i.value),T(L.point([r.max,a.max]),i.value)),e.tilematrix={},e.tilematrix.col=r,e.tilematrix.row=a):console.log("Unable to determine bounds for tile template: "+e.template),e.tilematrix||(e.tilematrix={},e.tilematrix.col={},e.tilematrix.row={}),e.tilematrix.bounds=[];for(var A=e.pcrs.bounds,S=e.zoom?e.zoom.min:0,M=e.zoom?e.zoom.max:l.resolutions.length,z=0;z<=M;z++)e.tilematrix.bounds[z]=z>=S?L.bounds(E(A.min,z),E(A.max,z)):L.bounds(L.point([-1,-1]),L.point([-1,-1]))}}),m=function(t,e){return new l(t,e)},u=L.Layer.extend({initialize:function(t,e){this._templates=t,L.setOptions(this,e),this._container=L.DomUtil.create("div","leaflet-layer",e.pane),L.DomUtil.addClass(this._container,"mapml-templatedlayer-container");for(var i=0;i<t.length;i++)"tile"===t[i].rel?this._templates[i].layer=M.templatedTileLayer(t[i],L.Util.extend(e,{errorTileUrl:"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",zIndex:i,pane:this._container})):"image"===t[i].rel?this._templates[i].layer=M.templatedImageLayer(t[i],L.Util.extend(e,{zIndex:i,pane:this._container})):"features"===t[i].rel?this._templates[i].layer=M.templatedFeaturesLayer(t[i],L.Util.extend(e,{zIndex:i,pane:this._container})):"query"===t[i].rel&&(this.hasSetBoundsHandler=!0,this._queries||(this._queries=[]),this._queries.push(L.extend(t[i],this._setupQueryVars(t[i]))))},getEvents:function(){return{zoomstart:this._onZoomStart}},redraw:function(){this.closePopup();for(var t=0;t<this._templates.length;t++)"tile"!==this._templates[t].rel&&"image"!==this._templates[t].rel&&"features"!==this._templates[t].rel||this._templates[t].layer.redraw()},_onZoomStart:function(){this.closePopup()},_setupQueryVars:function(t){for(var e={query:{}},i=t.values,o=0;o<t.values.length;o++){var n=i[o].getAttribute("type"),a=i[o].getAttribute("units"),r=i[o].getAttribute("axis"),s=i[o].getAttribute("name"),l=i[o].getAttribute("position"),m=i[o].getAttribute("rel"),u="select"===i[o].tagName.toLowerCase();if("width"===n)e.query.width=s;else if("height"===n)e.query.height=s;else if("location"===n)switch(r){case"x":case"y":case"column":case"row":e.query[r]=s;break;case"longitude":case"easting":l?l.match(/.*?-left/i)?"pixel"===m?e.query.pixelleft=s:"tile"===m?e.query.tileleft=s:e.query.mapleft=s:l.match(/.*?-right/i)&&("pixel"===m?e.query.pixelright=s:"tile"===m?e.query.tileright=s:e.query.mapright=s):e.query[r]=s;break;case"latitude":case"northing":l?l.match(/top-.*?/i)?"pixel"===m?e.query.pixeltop=s:"tile"===m?e.query.tiletop=s:e.query.maptop=s:l.match(/bottom-.*?/i)&&("pixel"===m?e.query.pixelbottom=s:"tile"===m?e.query.tilebottom=s:e.query.mapbottom=s):e.query[r]=s;break;case"i":"tile"===a?e.query.tilei=s:e.query.mapi=s;break;case"j":"tile"===a?e.query.tilej=s:e.query.mapj=s}else if("zoom"===n)e.query.zoom=s;else if(u){const t=i[o].htmlselect;e.query[s]=function(){return t.value}}else{const t=i[o];e.query[s]=function(){return t.getAttribute("value")}}}return e.query.title=t.title,e},reset:function(t){if(t&&this._map){var e=this._map&&this._map.hasLayer(this),i=this._templates;delete this._queries,this._map.off("click",null,this),this._templates=t;for(var o=0;o<t.length;o++)"tile"===t[o].rel?this._templates[o].layer=M.templatedTileLayer(t[o],L.Util.extend(this.options,{errorTileUrl:"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",zIndex:o,pane:this._container})):"image"===t[o].rel?this._templates[o].layer=M.templatedImageLayer(t[o],L.Util.extend(this.options,{zIndex:o,pane:this._container})):"features"===t[o].rel?this._templates[o].layer=M.templatedFeaturesLayer(t[o],L.Util.extend(this.options,{zIndex:o,pane:this._container})):"query"===t[o].rel&&(this._queries||(this._queries=[]),this._queries.push(L.extend(t[o],this._setupQueryVars(t[o])))),e&&this.onAdd(this._map);for(o=0;o<i.length;o++)this._map.hasLayer(i[o].layer)&&this._map.removeLayer(i[o].layer)}},onAdd:function(t){for(var e=0;e<this._templates.length;e++)"query"!==this._templates[e].rel&&t.addLayer(this._templates[e].layer)},onRemove:function(t){L.DomUtil.remove(this._container);for(var e=0;e<this._templates.length;e++)"query"!==this._templates[e].rel&&t.removeLayer(this._templates[e].layer)}}),c=function(t,e){return new u(t,e)},h=L.Layer.extend({initialize:function(t,e){let i=M.extractInputBounds(t);this.zoomBounds=i.zoomBounds,this.layerBounds=i.bounds,this.isVisible=!0,this._template=t,this._container=L.DomUtil.create("div","leaflet-layer",e.pane),L.extend(e,this.zoomBounds),L.DomUtil.addClass(this._container,"mapml-features-container"),L.setOptions(this,L.extend(e,this._setUpFeaturesTemplateVars(t)))},getEvents:function(){return{moveend:this._onMoveEnd}},onAdd:function(){this._map._addZoomLimit(this);var t,e=new Headers({Accept:"text/mapml"}),i=new DOMParser,o=this.options.opacity,n=this._container,a=this._map;this._features||(this._features=M.mapMlFeatures(null,{renderer:L.svg(),pane:n,opacity:o,imagePath:this.options.imagePath,onEachFeature:function(t,e){var i=document.createElement("div");i.insertAdjacentHTML("afterbegin",t.innerHTML),e.bindPopup(i,{autoPan:!1})}}));var r=this._features,s=function(o,n){return fetch(o,{redirect:"follow",headers:e}).then(function(t){return t.text()}).then(function(e){t=i.parseFromString(e,"application/xml");var a=new URL(t.querySelector("base")?t.querySelector("base").getAttribute("href"):o).href;if(o=(o=t.querySelector("link[rel=next]")?t.querySelector("link[rel=next]").getAttribute("href"):null)?new URL(o,a).href:null,r.addData(t),o&&--n)return s(o,n)})};s(this._getfeaturesUrl(),10).then(function(){a.addLayer(r)}).catch(function(t){console.log(t)})},_onMoveEnd:function(){let t=this._map.getZoom(),e=M.pixelToPCRSBounds(this._map.getPixelBounds(),t,this._map.options.projection);if(this.isVisible=t<=this.zoomBounds.maxZoom&&t>=this.zoomBounds.minZoom&&this.layerBounds.overlaps(e),this._features.clearLayers(),this.isVisible){var i,o=new Headers({Accept:"text/mapml;q=0.9,application/geo+json;q=0.8"}),n=new DOMParser,a=this._features,r=this._map,s=function(t,e){return fetch(t,{redirect:"follow",headers:o}).then(function(t){return t.text()}).then(function(o){i=n.parseFromString(o,"application/xml");var r=new URL(i.querySelector("base")?i.querySelector("base").getAttribute("href"):t).href;if(t=(t=i.querySelector("link[rel=next]")?i.querySelector("link[rel=next]").getAttribute("href"):null)?new URL(t,r).href:null,a.addData(i),t&&--e)return s(t,e)})};s(this._getfeaturesUrl(),10).then(function(){r.addLayer(a)}).catch(function(t){console.log(t)})}},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},onRemove:function(){this._map.removeLayer(this._features)},_getfeaturesUrl:function(){var t=this._map.getPixelBounds(),e=t.getTopLeft(),i=t.getTopRight(),o=t.getBottomRight(),n=t.getBottomLeft(),a=this._map.getBounds();a.extend(this._map.unproject(n)).extend(this._map.unproject(o)).extend(this._map.unproject(e)).extend(this._map.unproject(i));var r={};for(var s in r[this.options.feature.zoom.name]=this._map.getZoom(),r[this.options.feature.bottom.name]=a.getSouth(),r[this.options.feature.left.name]=a.getWest(),r[this.options.feature.top.name]=a.getNorth(),r[this.options.feature.right.name]=a.getEast(),this.options.feature)["width","height","left","right","top","bottom","zoom"].indexOf(s)<0&&(r[s]=this.options.feature[s]);return L.Util.template(this._template.template,r)},_setUpFeaturesTemplateVars:function(t){var e={feature:{}},i=t.values;e.feature.hidden=[];for(var o=0;o<i.length;o++){var n=i[o].getAttribute("type"),a=i[o].getAttribute("units"),r=i[o].getAttribute("axis"),s=i[o].getAttribute("name"),l=i[o].getAttribute("position"),m=i[o].getAttribute("value"),u="select"===i[o].tagName.toLowerCase();if("width"===n)e.feature.width={name:s};else if("height"===n)e.feature.height={name:s};else if("zoom"===n)e.feature.zoom={name:s};else if("location"!==n||"pcrs"!==a&&"gcrs"!==a&&"tcrs"!==a)if(u){const t=i[o].htmlselect;e.feature[s]=function(){return t.value}}else"hidden"!==n&&"projection"!==n||e.feature.hidden.push({name:s,value:m});else switch(r){case"x":case"longitude":case"easting":l&&(l.match(/.*?-left/i)?e.feature.left={name:s,axis:r}:l.match(/.*?-right/i)&&(e.feature.right={name:s,axis:r}));break;case"y":case"latitude":case"northing":l&&(l.match(/top-.*?/i)?e.feature.top={name:s,axis:r}:l.match(/bottom-.*?/i)&&(e.feature.bottom={name:s,axis:r}))}}return e}}),p=function(t,e){return new h(t,e)},d=L.Layer.extend({initialize:function(t,e){this._template=t,this._container=L.DomUtil.create("div","leaflet-layer",e.pane),L.DomUtil.addClass(this._container,"mapml-image-container");let i=M.extractInputBounds(t);this.zoomBounds=i.zoomBounds,this.layerBounds=i.bounds,this.isVisible=!0,L.extend(e,this.zoomBounds),L.setOptions(this,L.extend(e,this._setUpExtentTemplateVars(t)))},getEvents:function(){return{moveend:this._onMoveEnd}},onAdd:function(){this._map._addZoomLimit(this),this.setZIndex(this.options.zIndex),this._map.fire("moveend",!0)},redraw:function(){this._onMoveEnd()},_clearLayer:function(){let t=this._container.querySelectorAll("img");for(let e=0;e<t.length;e++)this._container.removeChild(t[e])},_onMoveEnd:function(){let t=this._map.getZoom(),e=M.pixelToPCRSBounds(this._map.getPixelBounds(),t,this._map.options.projection);if(this.isVisible=t<=this.zoomBounds.maxZoom&&t>=this.zoomBounds.minZoom&&this.layerBounds.overlaps(e),this.isVisible){var i=this._map,o=i.getPixelBounds().min.subtract(i.getPixelOrigin()),n=i.getSize(),a=this.getImageUrl(),r=this._imageOverlay;this._imageOverlay=M.imageOverlay(a,o,n,0,this._container),this._imageOverlay.addTo(i),r&&this._imageOverlay.on("load error",function(){i.removeLayer(r)})}else this._clearLayer()},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},onRemove:function(t){this._clearLayer(),t._removeZoomLimit(this),this._container=null},getImageUrl:function(){var t={};for(var e in t[this.options.extent.width]=this._map.getSize().x,t[this.options.extent.height]=this._map.getSize().y,t[this.options.extent.bottom]=this._TCRSToPCRS(this._map.getPixelBounds().max,this._map.getZoom()).y,t[this.options.extent.left]=this._TCRSToPCRS(this._map.getPixelBounds().min,this._map.getZoom()).x,t[this.options.extent.top]=this._TCRSToPCRS(this._map.getPixelBounds().min,this._map.getZoom()).y,t[this.options.extent.right]=this._TCRSToPCRS(this._map.getPixelBounds().max,this._map.getZoom()).x,this.options.extent)["width","height","left","right","top","bottom"].indexOf(e)<0&&(t[e]=this.options.extent[e]);return L.Util.template(this._template.template,t)},_TCRSToPCRS:function(t,e){var i=this._map.options.crs;return i.transformation.untransform(t,i.scale(e))},_setUpExtentTemplateVars:function(t){for(var e={extent:{}},i=t.values,o=0;o<t.values.length;o++){var n=i[o].getAttribute("type"),a=i[o].getAttribute("units"),r=i[o].getAttribute("axis"),s=i[o].getAttribute("name"),l=i[o].getAttribute("position"),m="select"===i[o].tagName.toLowerCase();if("width"===n)e.extent.width=s;else if("height"===n)e.extent.height=s;else if("location"!==n||"pcrs"!==a&&"gcrs"!==a)if(m){const t=i[o].htmlselect;e.extent[s]=function(){return t.value}}else{const t=i[o];e.extent[s]=function(){return t.getAttribute("value")}}else switch(r){case"longitude":case"easting":l&&(l.match(/.*?-left/i)?e.extent.left=s:l.match(/.*?-right/i)&&(e.extent.right=s));break;case"latitude":case"northing":l&&(l.match(/top-.*?/i)?e.extent.top=s:l.match(/bottom-.*?/i)&&(e.extent.bottom=s))}}return e}}),g=function(t,e){return new d(t,e)},y=L.ImageOverlay.extend({initialize:function(t,e,i,o,n,a){this._container=n,this._url=t,this._location=e,this._size=L.point(i),this._angle=o,L.setOptions(this,a)},getEvents:function(){var t={viewreset:this._reset};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},onAdd:function(){this.on({load:this._onImageLoad}),this._image||this._initImage(),this.options.interactive&&(L.DomUtil.addClass(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this._container.appendChild(this._image),this._reset()},onRemove:function(){L.DomUtil.remove(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},_onImageLoad:function(){this._image&&(this._image.loaded=+new Date,this._updateOpacity())},_animateZoom:function(t){var e=this._map.getZoomScale(t.zoom),i=this._map.getPixelOrigin().add(this._location).multiplyBy(e).subtract(this._map._getNewPixelOrigin(t.center,t.zoom)).round();L.Browser.any3d?L.DomUtil.setTransform(this._image,i,e):L.DomUtil.setPosition(this._image,i)},_reset:function(){var t=this._image,e=this._location,i=this._size;L.DomUtil.setPosition(t,e),t.style.width=i.x+"px",t.style.height=i.y+"px"},_updateOpacity:function(){if(this._map){var t=+new Date,e=!1,i=this._image,o=Math.min(1,(t-i.loaded)/200);L.DomUtil.setOpacity(i,o),o<1&&(e=!0),e&&(L.Util.cancelAnimFrame(this._fadeFrame),this._fadeFrame=L.Util.requestAnimFrame(this._updateOpacity,this)),L.DomUtil.addClass(i,"leaflet-image-loaded")}}}),x=function(t,e,i,o,n,a){return new y(t,e,i,o,n,a)},_=L.Layer.extend({options:{maxNext:10,zIndex:0,maxZoom:25},initialize:function(t,e,i){var o;t&&(this._href=t),e&&(this._layerEl=e,o=!!e.querySelector("image,feature,tile,extent"),!t&&o&&(this._content=e)),this._container=L.DomUtil.create("div","leaflet-layer"),L.DomUtil.addClass(this._container,"mapml-layer"),this._imageContainer=L.DomUtil.create("div","leaflet-layer",this._container),L.DomUtil.addClass(this._imageContainer,"mapml-image-container"),this._mapmlTileContainer=L.DomUtil.create("div","mapml-tile-container",this._container),this._initCount=0,this._initExtent(o?e:null),this.on("attached",this._validateExtent,this),L.setOptions(this,i)},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_changeOpacity:function(t){t&&t.target&&t.target.value>=0&&t.target.value<=1&&this.changeOpacity(t.target.value)},changeOpacity:function(t){this._container.style.opacity=t},onAdd:function(t){this._map=t,this._content?(this._mapmlvectors||(this._mapmlvectors=M.mapMlFeatures(this._content,{renderer:L.svg(),pane:this._container,opacity:this.options.opacity,imagePath:M.detectImagePath(this._map.getContainer()),_leafletLayer:this,onEachFeature:function(t,e){if(t){var i=document.createElement("div");i.insertAdjacentHTML("afterbegin",t.innerHTML),e.bindPopup(i,{autoPan:!1})}}})),t.addLayer(this._mapmlvectors)):this.once("extentload",function(){this._mapmlvectors||(this._mapmlvectors=M.mapMlFeatures(this._content,{renderer:L.svg(),pane:this._container,opacity:this.options.opacity,imagePath:M.detectImagePath(this._map.getContainer()),_leafletLayer:this,onEachFeature:function(t,e){if(t){var i=document.createElement("div");i.insertAdjacentHTML("afterbegin",t.innerHTML),e.bindPopup(i,{autoPan:!1})}}}).addTo(t)),this._setLayerElExtent()},this),this._imageLayer||(this._imageLayer=L.layerGroup()),t.addLayer(this._imageLayer),(!this._staticTileLayer||null===this._staticTileLayer._container)&&this._mapmlTileContainer.getElementsByTagName("tiles").length>0&&(this._staticTileLayer=M.mapMLStaticTileLayer({pane:this._container,className:"mapml-static-tile-layer",tileContainer:this._mapmlTileContainer,maxZoomBound:t.options.crs.options.resolutions.length-1}),t.addLayer(this._staticTileLayer)),this._extent?this._templateVars&&(this._templatedLayer=M.templatedLayer(this._templateVars,{pane:this._container,imagePath:M.detectImagePath(this._map.getContainer()),_leafletLayer:this,crs:this.crs}).addTo(t)):this.once("extentload",function(){this._templateVars&&(this._templatedLayer=M.templatedLayer(this._templateVars,{pane:this._container,imagePath:M.detectImagePath(this._map.getContainer()),_leafletLayer:this,crs:this.crs}).addTo(t),this._setLayerElExtent())},this),this._setLayerElExtent(),this.setZIndex(this.options.zIndex),this.getPane().appendChild(this._container)},_setLayerElExtent:function(){let t,e;["_staticTileLayer","_imageLayer","_mapmlvectors","_templatedLayer"].forEach(i=>{if(this[i])if("_templatedLayer"===i)for(let o=0;o<this[i]._templates.length;o++)"query"!==this[i]._templates[o].rel&&this[i]._templates[o].layer.layerBounds&&(t?(t.extend(this[i]._templates[o].layer.layerBounds.min),t.extend(this[i]._templates[o].layer.layerBounds.max)):(t=this[i]._templates[o].layer.layerBounds,e=this[i]._templates[o].layer.zoomBounds));else this[i].layerBounds&&(t?(t.extend(this[i].layerBounds.min),t.extend(this[i].layerBounds.max)):(t=this[i].layerBounds,e=this[i].zoomBounds))}),t&&(this._layerEl.extent=Object.assign(M.convertAndFormatPCRS(t,this._map),{zoom:e}))},addTo:function(t){return t.addLayer(this),this},getEvents:function(){return{zoomanim:this._onZoomAnim}},redraw:function(){this._templatedLayer&&this._templatedLayer.redraw()},_onZoomAnim:function(t){var e=t.zoom,i=this._extent.querySelector("input[type=zoom]"),o=i&&i.hasAttribute("min")?parseInt(i.getAttribute("min")):this._map.getMinZoom(),n=i&&i.hasAttribute("max")?parseInt(i.getAttribute("max")):this._map.getMaxZoom(),a=e<o&&this._extent.zoomout||e>n&&this._extent.zoomin;o<=e&&e<=n||(this._extent.zoomin&&e>n?(this._href=this._extent.zoomin,this.href=this._extent.zoomin):this._extent.zoomout&&e<o&&(this._href=this._extent.zoomout,this.href=this._extent.zoomout)),this._templatedLayer&&a&&this._initExtent()},onRemove:function(t){L.DomUtil.remove(this._container),this._staticTileLayer&&t.removeLayer(this._staticTileLayer),this._mapmlvectors&&t.removeLayer(this._mapmlvectors),t.removeLayer(this._imageLayer),this._templatedLayer&&t.removeLayer(this._templatedLayer)},getZoomBounds:function(){var t=this._extent,e=t?t.querySelector("[type=zoom]"):void 0,i=e&&e.hasAttribute("min")?e.getAttribute("min"):this._map.getMinZoom(),o=e&&e.hasAttribute("max")?e.getAttribute("max"):this._map.getMaxZoom(),n={};return n.min=Math.min(i,o),n.max=Math.max(i,o),n},_transformDeprectatedInput:function(t){var e=t.getAttribute("type").toLowerCase();if("xmin"===e||"ymin"===e||"xmax"===e||"ymax"===e)switch(t.setAttribute("type","location"),t.setAttribute("units","tcrs"),e){case"xmin":t.setAttribute("axis","x"),t.setAttribute("position","top-left");break;case"ymin":t.setAttribute("axis","y"),t.setAttribute("position","top-left");break;case"xmax":t.setAttribute("axis","x"),t.setAttribute("position","bottom-right");break;case"ymax":t.setAttribute("axis","y"),t.setAttribute("position","bottom-right")}},_setUpInputVars:function(t){var e={extent:{}};e.extent.hidden=[];for(var i=0;i<t.length;i++){this._transformDeprectatedInput(t[i]);var o=t[i].getAttribute("type"),n=t[i].getAttribute("units"),a=t[i].getAttribute("axis"),r=t[i].getAttribute("name"),s=t[i].getAttribute("position"),l=t[i].getAttribute("value");if("width"===o)e.extent.width={name:r};else if("height"===o)e.extent.height={name:r};else if("zoom"===o)e.extent.zoom={name:r};else if("location"!==o||"pcrs"!==n&&"gcrs"!==n&&"tcrs"!==n)"hidden"!==o&&"projection"!==o||e.extent.hidden.push({name:r,value:l});else switch(a){case"easting":s&&(s.match(/.*?-left/i)?e.extent.left={name:r,axis:a}:s.match(/.*?-right/i)&&(e.extent.right={name:r,axis:a}));break;case"northing":s&&(s.match(/top-.*?/i)?e.extent.top={name:r,axis:a}:s.match(/bottom-.*?/i)&&(e.extent.bottom={name:r,axis:a}));break;case"x":s&&(s.match(/.*?-left/i)?e.extent.left={name:r,axis:a}:s.match(/.*?-right/i)&&(e.extent.right={name:r,axis:a}));break;case"y":s&&(s.match(/top-.*?/i)?e.extent.top={name:r,axis:a}:s.match(/bottom-.*?/i)&&(e.extent.bottom={name:r,axis:a}));break;case"longitude":s&&(s.match(/.*?-left/i)?e.extent.left={name:r,axis:a}:s.match(/.*?-right/i)&&(e.extent.right={name:r,axis:a}));break;case"latitude":s&&(s.match(/top-.*?/i)?e.extent.top={name:r,axis:a}:s.match(/bottom-.*?/i)&&(e.extent.bottom={name:r,axis:a}))}}return e},getLayerExtentBounds:function(t){if(this._extent){var e,i,o,n,a,r,s,l,m=t.getZoom(),u=t.options.projection,c=u!==this._extent.getAttribute("units");if(r=this._extent.querySelector("[type=xmin]").getAttribute("min"),s=this._extent.querySelector("[type=xmax]").getAttribute("min"),i=Math.min(r,s),r=this._extent.querySelector("[type=xmin]").getAttribute("max"),s=this._extent.querySelector("[type=xmax]").getAttribute("max"),n=Math.max(r,s),r=this._extent.querySelector("[type=ymin]").getAttribute("min"),s=this._extent.querySelector("[type=ymax]").getAttribute("min"),o=Math.min(r,s),r=this._extent.querySelector("[type=ymin]").getAttribute("max"),s=this._extent.querySelector("[type=ymax]").getAttribute("max"),a=Math.max(r,s),c){var h=[(e=M[u]).latLngToPoint(L.latLng([o,i]),m),e.latLngToPoint(L.latLng([a,n]),m),e.latLngToPoint(L.latLng([o,i]),m),e.latLngToPoint(L.latLng([o,n]),m)];return L.bounds(h)}return(l=parseInt(this._extent.querySelector("[type=zoom]").getAttribute("value")))!==m?(e=M[u],L.bounds(e.latLngToPoint(e.pointToLatLng(L.point(i,o),l),m),e.latLngToPoint(e.pointToLatLng(L.point(n,a),l),m))):L.bounds(L.point(i,o),L.point(n,a))}},getAttribution:function(){return this.options.attribution},getLayerUserControlsHTML:function(){var t=document.createElement("fieldset"),e=document.createElement("input"),i=document.createElement("label"),o=document.createElement("span"),n=document.createElement("details"),a=document.createElement("summary"),r=document.createElement("input"),s=document.createElement("details"),l=document.createElement("summary"),m=document.createElement("label");if(e.defaultChecked=!!this._map,e.type="checkbox",e.className="leaflet-control-layers-selector",o.draggable=!0,this._legendUrl){var u=document.createElement("a");u.text=" "+this._title,u.href=this._legendUrl,u.target="_blank",o.appendChild(u)}else o.innerHTML=" "+this._title;if(i.appendChild(e),i.appendChild(o),m.innerText="Opacity",r.id="o"+L.stamp(r),m.setAttribute("for",r.id),l.appendChild(m),s.appendChild(l),s.appendChild(r),L.DomUtil.addClass(n,"mapml-control-layers"),L.DomUtil.addClass(s,"mapml-control-layers"),r.setAttribute("type","range"),r.setAttribute("min","0"),r.setAttribute("max","1.0"),r.setAttribute("value",this._container.style.opacity||"1.0"),r.setAttribute("step","0.1"),r.value=this._container.style.opacity||"1.0",L.DomEvent.on(r,"change",this._changeOpacity,this),L.DomEvent.on(o,"dragstart",function(t){this._href&&(t.dataTransfer.setData("text/uri-list",this._href),t.dataTransfer.setData("text/plain",this._href))},this),t.appendChild(n),n.appendChild(a),a.appendChild(i),n.appendChild(s),this._styles&&n.appendChild(this._styles),this._userInputs){var c=document.createDocumentFragment(),h=this._templateVars;if(h)for(var p=0;p<h.length;p++)for(var d=h[p],g=0;g<d.values.length;g++){var y=d.values[g],x="#"+y.getAttribute("id");if("select"===y.tagName.toLowerCase()&&!c.querySelector(x)){var _=document.createElement("fieldset"),f=document.createElement("details"),b=document.createElement("summary"),v=document.createElement("label");v.innerText=y.getAttribute("name"),v.setAttribute("for",y.getAttribute("id")),L.DomUtil.addClass(f,"mapml-control-layers"),b.appendChild(v),f.appendChild(b),f.appendChild(y.htmlselect),_.appendChild(f),c.appendChild(_)}}n.appendChild(c)}return t},_initExtent:function(t){if(this._href||t){var i,o,n=this;if(this._href){var a=new XMLHttpRequest;i=this._href,o=r,a.onreadystatechange=function(){this.readyState===this.DONE&&(400!==this.status&&404!==this.status&&500!==this.status&&406!==this.status||(n.error=!0,n.fire("extentload",n,!0),a.abort()))},a.onload=o,a.onerror=function(){n.error=!0,n.fire("extentload",n,!0)},a.open("GET",i),a.setRequestHeader("Accept",M.mime),a.overrideMimeType("text/xml"),a.send()}else t&&r.call(this,t)}function r(t){var i=this.responseXML||t;if(i.querySelector("feature")&&(n._content=i),!this.responseXML&&this.responseText&&(i=(new DOMParser).parseFromString(this.responseText,"text/xml")),this.readyState===this.DONE&&i.querySelector){var o=i.querySelector("extent")||i.querySelector("meta[name=projection]"),a=o&&o.hasAttribute("units")&&o.getAttribute("units").toUpperCase()===n.options.mapprojection||o&&o.hasAttribute("content")&&M.metaContentToObject(o.getAttribute("content")).content===n.options.mapprojection,r=!a&&i.querySelector("head link[rel=alternate][projection="+n.options.mapprojection+"]"),s=new URL(i.querySelector("base")?i.querySelector("base").getAttribute("href"):i.baseURI||this.responseURL,this.responseURL).href;if(o){if(!a&&r&&r.hasAttribute("href"))return void n.fire("changeprojection",{href:new URL(r.getAttribute("href"),s).href},!1);if(o.querySelector("link[rel=tile],link[rel=image],link[rel=features],link[rel=query]")&&o.hasAttribute("units")){n._templateVars=[];for(var l=o.querySelectorAll("link[rel=tile],link[rel=image],link[rel=features],link[rel=query]"),m=new RegExp("(?:{)(.*?)(?:})","g"),u=o.querySelector('input[type="zoom" i]'),c=!1,h=0;h<l.length;h++){for(var p,d=l[h],g=d.getAttribute("tref"),y=d.hasAttribute("title")?d.getAttribute("title"):"Query this layer",x=g.match(m),_=d.hasAttribute("rel")&&"tile"!==d.getAttribute("rel").toLowerCase()?d.getAttribute("rel").toLowerCase():"tile",f=d.hasAttribute("type")?d.getAttribute("type").toLowerCase():"image/*",b=[],v=i.querySelector("meta[name=zoom]")?M.metaContentToObject(i.querySelector("meta[name=zoom]").getAttribute("content")):void 0;null!==(p=m.exec(g));){var T=p[1],E=o.querySelector("input[name="+T+"],select[name="+T+"]");if(!E){console.log("input with name="+T+" not found for template variable of same name");break}if(b.push(E),c=c||E.hasAttribute("type")&&"zoom"===E.getAttribute("type").toLowerCase(),E.hasAttribute("shard")){var A=E.getAttribute("list");E.servers=[];var S=o.querySelectorAll("datalist#"+A+" > option");0===S.length&&E.hasAttribute("value")&&(S=E.getAttribute("value").split(""));for(var z=0;z<S.length;z++)S[z].getAttribute?E.servers.push(S[z].getAttribute("value")):E.servers.push(S[z])}else if("select"===E.tagName.toLowerCase()){var C=document.createElement("div");C.insertAdjacentHTML("afterbegin",E.outerHTML),E.htmlselect=C.querySelector("select"),L.DomEvent.on(E.htmlselect,"change",n.redraw,n),n._userInputs||(n._userInputs=[]),n._userInputs.push(E.htmlselect)}}g&&x.length===b.length&&("query"===_&&(n.queryable=!0),!c&&u&&b.push(u),n._templateVars.push({template:decodeURI(new URL(g,s)),title:y,rel:_,type:f,values:b,zoomBounds:v,projection:o.getAttribute("units")||e}))}}}else o=n._synthesizeExtent(i),i.querySelector("feature,image,tile")&&(n._content=i);n._parseLicenseAndLegend(i,n),n._extent=o;var I=i.querySelector("link[rel=zoomin]"),B=i.querySelector("link[rel=zoomout]");if(delete n._extent.zoomin,delete n._extent.zoomout,I&&(n._extent.zoomin=new URL(I.getAttribute("href"),s).href),B&&(n._extent.zoomout=new URL(B.getAttribute("href"),s).href),n._templatedLayer&&n._templatedLayer.reset(n._templateVars),i.querySelector("tile")){var w=document.createElement("tiles"),N=i.querySelector("meta[name=zoom][content]")||i.querySelector("input[type=zoom][value]");w.setAttribute("zoom",N&&N.getAttribute("content")||N&&N.getAttribute("value")||"0");for(var P=i.getElementsByTagName("tile"),q=0;q<P.length;q++)w.appendChild(document.importNode(P[q],!0));n._mapmlTileContainer.appendChild(w)}M.parseStylesheetAsHTML(i,s,n._container);var k=i.querySelectorAll('link[rel=style],link[rel="self style"],link[rel="style self"]');if(k.length>1){var O=document.createElement("details"),R=document.createElement("summary");R.innerText="style",O.appendChild(R);for(var U=function(t){n.fire("changestyle",{src:t.target.getAttribute("data-href")},!1)},Z=0;Z<k.length;Z++){var j=document.createElement("span"),D=j.appendChild(document.createElement("input"));D.setAttribute("type","radio"),D.setAttribute("id","rad"+Z),D.setAttribute("name","styles"),D.setAttribute("value",k[Z].getAttribute("title")),D.setAttribute("data-href",new URL(k[Z].getAttribute("href"),s).href);var F=j.appendChild(document.createElement("label"));F.setAttribute("for","rad"+Z),F.innerText=k[Z].getAttribute("title"),"style self"!==k[Z].getAttribute("rel")&&"self style"!==k[Z].getAttribute("rel")||(D.checked=!0),O.appendChild(j),L.DomUtil.addClass(O,"mapml-control-layers"),L.DomEvent.on(D,"click",U,n)}n._styles=O}i.querySelector("title")?n._title=i.querySelector("title").textContent.trim():i.hasAttribute("label")&&(n._title=i.getAttribute("label").trim()),n._map&&(n._validateExtent(),n._map.hasLayer(n)&&n._map.attributionControl.addAttribution(n.getAttribution()))}else n.error=!0;n.fire("extentload",n,!1)}},_createExtent:function(){var t=document.createElement("extent"),e=document.createElement("input"),i=document.createElement("input"),o=document.createElement("input"),n=document.createElement("input"),a=document.createElement("input"),r=document.createElement("input");return a.setAttribute("type","zoom"),a.setAttribute("min","0"),a.setAttribute("max","0"),e.setAttribute("type","xmin"),e.setAttribute("min",""),e.setAttribute("max",""),i.setAttribute("type","ymin"),i.setAttribute("min",""),i.setAttribute("max",""),o.setAttribute("type","xmax"),o.setAttribute("min",""),o.setAttribute("max",""),n.setAttribute("type","ymax"),n.setAttribute("min",""),n.setAttribute("max",""),r.setAttribute("type","projection"),r.setAttribute("value","WGS84"),t.appendChild(e),t.appendChild(i),t.appendChild(o),t.appendChild(n),t.appendChild(a),t.appendChild(r),t},_validateExtent:function(){var t=this._extent;if(t&&t.querySelector&&this._map){if(t.querySelector('[type=xmin][min=""], [type=xmin][max=""], [type=xmax][min=""], [type=xmax][max=""], [type=ymin][min=""], [type=ymin][max=""]')){var e,i,o=t.querySelector("[type=xmin]"),n=t.querySelector("[type=ymin]"),a=t.querySelector("[type=xmax]"),r=t.querySelector("[type=ymax]"),s=t.querySelector("[type=projection][value]");s?(i=s.getAttribute("value"))&&"WGS84"===i?(e=this._map.getBounds(),o.setAttribute("min",e.getWest()),o.setAttribute("max",e.getEast()),n.setAttribute("min",e.getSouth()),n.setAttribute("max",e.getNorth()),a.setAttribute("min",e.getWest()),a.setAttribute("max",e.getEast()),r.setAttribute("min",e.getSouth()),r.setAttribute("max",e.getNorth())):i&&(e=this._map.getPixelBounds(),o.setAttribute("min",e.getBottomLeft().x),o.setAttribute("max",e.getTopRight().x),n.setAttribute("min",e.getTopRight().y),n.setAttribute("max",e.getBottomLeft().y),a.setAttribute("min",e.getBottomLeft().x),a.setAttribute("max",e.getTopRight().x),r.setAttribute("min",e.getTopRight().y),r.setAttribute("max",e.getBottomLeft().y)):this.error=!0}if(t.querySelector('[type=zoom][min=""], [type=zoom][max=""]')){var l=t.querySelector("[type=zoom]");l.setAttribute("min",this._map.getMinZoom()),l.setAttribute("max",this._map.getMaxZoom())}var m=t.hasAttribute("units")?t.getAttribute("units"):null;this.crs=m&&"OSMTILE"===m||"WGS84"===m||"APSTILE"===m||"CBMTILE"===m?M[m]:M.OSMTILE}},_getMapMLExtent:function(t,e,i){var o=this._createExtent(),n=o.querySelector("input[type=zoom]"),a=o.querySelector("input[type=xmin]"),r=o.querySelector("input[type=ymin]"),s=o.querySelector("input[type=xmax]"),l=o.querySelector("input[type=ymax]"),m=o.querySelector("input[type=projection]"),u=void 0!==e[0]&&void 0!==e[1]?Math.min(e[0],e[1]):"",c=void 0!==e[0]&&void 0!==e[1]?Math.max(e[0],e[1]):"",h=t?t._southWest?t.getWest():t.getBottomLeft().x:"",p=t?t._southWest?t.getSouth():t.getTopRight().y:"",d=t?t._southWest?t.getEast():t.getTopRight().x:"",g=t?t._southWest?t.getNorth():t.getBottomLeft().y:"";return n.setAttribute("min","number"==typeof u&&isNaN(u)?"":u),n.setAttribute("max","number"==typeof c&&isNaN(c)?"":c),a.setAttribute("min",h),a.setAttribute("max",d),r.setAttribute("min",p),r.setAttribute("max",g),s.setAttribute("min",h),s.setAttribute("max",d),l.setAttribute("min",p),l.setAttribute("max",g),m.setAttribute("value",t&&t._southWest&&!i?"WGS84":i),o},_synthesizeExtent:function(t){var i,o,n,a,r,s,l,m,u,c,h,p,d=t.querySelectorAll("meta[name=zoom]")[0],g=t.querySelector("meta[name=extent]"),y=t.querySelector("meta[name=projection]"),x=y?y.getAttribute("content"):e;if(d)for(o=d.getAttribute("content").split(","),i=0;i<o.length;i++)h=(c=o[i].split("="))[0],p=c[1],"min"===h&&(a=parseInt(p)),"max"===h&&(r=parseInt(p));if(g)for(o=g.getAttribute("content").split(","),i=0;i<o.length;i++)h=(c=o[i].split("="))[0],p=c[1],"xmin"===h&&(s=parseFloat(p)),"xmax"===h&&(m=parseFloat(p)),"ymin"===h&&(l=parseFloat(p)),"ymax"===h&&(u=parseFloat(p));if(s&&l&&m&&u&&"WGS84"===x){var _=L.latLng(l,s),f=L.latLng(u,m);n=L.latLngBounds(_,f)}else s&&l&&m&&u&&(n=L.bounds([[s,l],[m,u]]));return this._getMapMLExtent(n,[a,r],x)},getProjection:function(){if(!this._extent||!this._extent.querySelector("input[type=projection]"))return"WGS84";var t=this._extent.querySelector("input[type=projection]");return t.getAttribute("value")?t.getAttribute("value"):"WGS84"},_parseLicenseAndLegend:function(t,e){var i,o,n=t.querySelector("link[rel=license]");n&&(i=n.getAttribute("title"),o='<a href="'+n.getAttribute("href")+'" title="'+i+'">'+i+"</a>"),L.setOptions(e,{attribution:o});var a=t.querySelector("link[rel=legend]");a&&(e._legendUrl=a.getAttribute("href"))},_getUnprojectedMapLatLngBounds:function(t){var e=(t=t||this._map).getPixelOrigin(),i=t.getPixelBounds(),o=t.unproject(e),n=t.unproject(i.getBottomLeft()),a=t.unproject(i.getTopRight()),r=t.unproject(e.add(t.getSize()));return L.latLngBounds(n,a).extend(r).extend(o)},_projectionMatches:function(t){t=t||this._map;var e=this.getProjection();return!(!t.options.projection||"WGS84"!==e&&t.options.projection!==e)},getQueryTemplates:function(){if(this._templatedLayer&&this._templatedLayer._queries)return this._templatedLayer._queries}}),f=function(t,e,i){return t||e?new _(t,e,i):null},b=L.Handler.extend({addHooks:function(){L.setOptions(this,{mapEl:this._map.options.mapEl}),L.DomEvent.on(this._map,"click",this._queryTopLayer,this),L.DomEvent.on(this._map,"keypress",this._queryTopLayerAtMapCenter,this)},removeHooks:function(){L.DomEvent.off(this._map,"click",this._queryTopLayer,this),L.DomEvent.on(this._map,"keypress",this._queryTopLayerAtMapCenter,this)},_getTopQueryableLayer:function(){for(var t=this.options.mapEl.layers,e=t.length-1;e>=0;e--){var i=t[e]._layer;if(t[e].checked&&i.queryable)return i}},_queryTopLayerAtMapCenter:function(t){" "===t.originalEvent.key&&this._map.fire("click",{latlng:this._map.getCenter(),layerPoint:this._map.latLngToLayerPoint(this._map.getCenter()),containerPoint:this._map.latLngToContainerPoint(this._map.getCenter())})},_queryTopLayer:function(t){var e=this._getTopQueryableLayer();e&&this._query(t,e)},_query(e,i){var o={},n=i.getQueryTemplates()[0],a=e.target.getZoom(),r=this._map,s=i.crs,l=i._container,m={autoPan:!0,maxHeight:.5*r.getSize().y-50},u=function(t){return s.transformation.untransform(t,s.scale(a))},c=function(t){return s.unproject(s.transformation.untransform(t,s.scale(a)),a)},h=s.latLngToPoint(e.latlng,a),p=h.divideBy(t).floor(),d=new L.Bounds(h.divideBy(t).floor().multiplyBy(t),h.divideBy(t).ceil().multiplyBy(t));for(var g in o[n.query.tilei]=h.x.toFixed()-p.x*t,o[n.query.tilej]=h.y.toFixed()-p.y*t,o[n.query.mapi]=r.getSize().divideBy(2).x.toFixed(),o[n.query.mapj]=r.getSize().divideBy(2).y.toFixed(),o[n.query.pixelleft]=s.pointToLatLng(h,a).lng,o[n.query.pixeltop]=s.pointToLatLng(h,a).lat,o[n.query.pixelright]=s.pointToLatLng(h.add([1,1]),a).lng,o[n.query.pixelbottom]=s.pointToLatLng(h.add([1,1]),a).lat,o[n.query.column]=p.x,o[n.query.row]=p.y,o[n.query.x]=h.x.toFixed(),o[n.query.y]=h.y.toFixed(),o[n.query.easting]=u(h).x,o[n.query.northing]=u(h).y,o[n.query.longitude]=c(h).lng,o[n.query.latitude]=c(h).lat,o[n.query.zoom]=a,o[n.query.width]=r.getSize().x,o[n.query.height]=r.getSize().y,o[n.query.mapbottom]=u(h.add(r.getSize().divideBy(2))).y,o[n.query.mapleft]=u(h.subtract(r.getSize().divideBy(2))).x,o[n.query.maptop]=u(h.subtract(r.getSize().divideBy(2))).y,o[n.query.mapright]=u(h.add(r.getSize().divideBy(2))).x,o[n.query.tilebottom]=u(d.max).y,o[n.query.tileleft]=u(d.min).x,o[n.query.tiletop]=u(d.min).y,o[n.query.tileright]=u(d.max).x,n.query)["mapi","mapj","tilei","tilej","row","col","x","y","easting","northing","longitude","latitude","width","height","zoom","mapleft","mapright",",maptop","mapbottom","tileleft","tileright","tiletop","tilebottom","pixeltop","pixelbottom","pixelleft","pixelright"].indexOf(g)<0&&(o[g]=n.query[g]);fetch(L.Util.template(n.template,o),{redirect:"follow"}).then(function(t){return t.status>=200&&t.status<300?Promise.resolve(t):(console.log("Looks like there was a problem. Status Code: "+t.status),Promise.reject(t))}).then(function(t){return t.headers.get("Content-Type").startsWith("text/mapml")?function(t,e){return t.text().then(t=>{var o=L.bind(s.unproject,s);var n=new DOMParser,a=n.parseFromString(t,"application/xml"),u=M.mapMlFeatures(a,{renderer:L.svg(),pane:l,color:"yellow",coordsToLatLng:function(t){return o(L.point(t))},imagePath:M.detectImagePath(r.getContainer())});u.addTo(r);var c=document.createElement("iframe");c.csp="script-src 'none'",c.style="border: none",c.srcdoc=a.querySelector("feature properties").innerHTML,i.bindPopup(c,m).openPopup(e),i.on("popupclose",function(){r.removeLayer(u)})})}(t,e.latlng):function(t,e,i){return t.text().then(t=>{var o=document.createElement("iframe");o.csp="script-src 'none'",o.style="border: none",o.srcdoc=t,e.bindPopup(o,m).openPopup(i)})}(t,i,e.latlng)}).catch(function(t){})}}),v=L.Handler.extend({_touchstart:L.Browser.msPointer?"MSPointerDown":L.Browser.pointer?"pointerdown":"touchstart",initialize:function(t){L.Handler.prototype.initialize.call(this,t),this._items=[{text:"Back (<kbd>B</kbd>)",callback:this._goBack},{text:"Forward (<kbd>F</kbd>)",callback:this._goForward},{text:"Reload (<kbd>R</kbd>)",callback:this._reload},{spacer:"-"},{text:"Toggle Controls (<kbd>T</kbd>)",callback:this._toggleControls},{text:"Copy Coordinates (<kbd>C</kbd>) >",callback:this._copyCoords,hideOnSelect:!1,popup:!0,submenu:[{text:"tile",callback:this._copyTile},{text:"tilematrix",callback:this._copyTileMatrix},{spacer:"-"},{text:"map",callback:this._copyMap},{spacer:"-"},{text:"tcrs",callback:this._copyTCRS},{text:"pcrs",callback:this._copyPCRS},{text:"gcrs",callback:this._copyGCRS},{spacer:"-"},{text:"All",callback:this._copyAllCoords}]},{text:"View Map Source (<kbd>V</kbd>)",callback:this._viewSource}],this._visible=!1,this._keyboardEvent=!1,this._container=L.DomUtil.create("div","mapml-contextmenu",t._container),this._container.style.zIndex=1e4,this._container.style.position="absolute",this._container.style.width="150px";for(let t=0;t<6;t++)this._items[t].el=this._createItem(this._container,this._items[t]);this._coordMenu=L.DomUtil.create("div","mapml-contextmenu mapml-submenu",this._container),this._coordMenu.style.zIndex=1e4,this._coordMenu.style.position="absolute",this._coordMenu.style.width="80px",this._coordMenu.id="mapml-copy-submenu",this._clickEvent=null;for(let t=0;t<this._items[5].submenu.length;t++)this._createItem(this._coordMenu,this._items[5].submenu[t],t);this._items[6].el=this._createItem(this._container,this._items[6]),L.DomEvent.on(this._container,"click",L.DomEvent.stop).on(this._container,"mousedown",L.DomEvent.stop).on(this._container,"dblclick",L.DomEvent.stop).on(this._container,"contextmenu",L.DomEvent.stop)},addHooks:function(){var t=this._map.getContainer();L.DomEvent.on(t,"mouseleave",this._hide,this).on(document,"keydown",this._onKeyDown,this),L.Browser.touch&&L.DomEvent.on(document,this._touchstart,this._hide,this),this._map.on({contextmenu:this._show,mousedown:this._hide,zoomstart:this._hide},this)},removeHooks:function(){var t=this._map.getContainer();L.DomEvent.off(t,"mouseleave",this._hide,this).off(document,"keydown",this._onKeyDown,this),L.Browser.touch&&L.DomEvent.off(document,this._touchstart,this._hide,this),this._map.off({contextmenu:this._show,mousedown:this._hide,zoomstart:this._hide},this)},_goForward:function(t){(t instanceof KeyboardEvent?this._map.options.mapEl:this.options.mapEl).forward()},_goBack:function(t){(t instanceof KeyboardEvent?this._map.options.mapEl:this.options.mapEl).back()},_reload:function(t){(t instanceof KeyboardEvent?this._map.options.mapEl:this.options.mapEl).reload()},_toggleControls:function(t){(t instanceof KeyboardEvent?this._map.options.mapEl:this.options.mapEl)._toggleControls(!0)},_viewSource:function(t){(t instanceof KeyboardEvent?this._map.options.mapEl:this.options.mapEl).viewSource()},_copyCoords:function(t){(this.contextMenu?this.contextMenu:this)._showCoordMenu(t)},_copyData:function(t){const e=document.createElement("textarea");e.value=t,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)},_copyGCRS:function(t){let e=this.options.mapEl,i=this.contextMenu._clickEvent;this.contextMenu._copyData(`z:${e.zoom}, lon :${i.latlng.lng}, lat:${i.latlng.lat}`)},_copyTCRS:function(t){let e=this.options.mapEl,i=this.contextMenu._clickEvent,o=e._map.project(i.latlng);this.contextMenu._copyData(`z: ${e.zoom}, x:${o.x}, y:${o.y}`)},_copyTileMatrix:function(e){let i=this.options.mapEl,o=this.contextMenu._clickEvent,n=i._map.project(o.latlng);this.contextMenu._copyData(`z: ${i.zoom}, column:${n.x/t}, row:${n.y/t}`)},_copyPCRS:function(t){let e=this.options.mapEl,i=this.contextMenu._clickEvent,o=e._map.project(i.latlng),n=e._map.options.crs.scale(+e.zoom),a=e._map.options.crs.transformation.untransform(o,n);this.contextMenu._copyData(`z: ${e.zoom}, easting:${a.x}, northing:${a.y}`)},_copyTile:function(e){let i=this.options.mapEl,o=this.contextMenu._clickEvent,n=i._map.options.crs.project(o.latlng),a=n.x%t,r=n.y%t;a<0&&(a+=t),r<0&&(r+=t),this.contextMenu._copyData(`z: ${i.zoom}, \n                                i:${Math.round(a)}, \n                                j:${Math.round(r)}`)},_copyMap:function(t){let e=this.options.mapEl,i=this.contextMenu._clickEvent;this.contextMenu._copyData(`z:${e.zoom}, i:${i.containerPoint.x}, j:${i.containerPoint.y}`)},_copyAllCoords:function(e){let i=this.options.mapEl,o=this.contextMenu._clickEvent,n=i._map.project(o.latlng),a=n.x%t,r=n.y%t,s=i._map.options.crs.scale(+i.zoom),l=i._map.options.crs.transformation.untransform(n,s),m=`z:${i.zoom}\n`;m+=`tile: i:${Math.round(a)}, j:${Math.round(r)}\n`,m+=`tilematrix: column:${n.x/t}, row:${n.y/t}\n`,m+=`map: i:${o.containerPoint.x}, j:${o.containerPoint.y}\n`,m+=`tcrs: x:${n.x}, y:${n.y}\n`,m+=`pcrs: easting:${l.x}, northing:${l.y}\n`,m+=`gcrs: lon :${o.latlng.lng}, lat:${o.latlng.lat}`,this.contextMenu._copyData(m)},_createItem:function(t,e,i){if(e.spacer)return this._createSeparator(t,i);var o=this._insertElementAt("a","mapml-contextmenu-item",t,i),n=this._createEventHandler(o,e.callback,e.context,e.hideOnSelect);return o.innerHTML=""+e.text,o.href="#",o.setAttribute("role","button"),e.popup&&(o.setAttribute("aria-haspopup","true"),o.setAttribute("aria-expanded","false"),o.setAttribute("aria-controls","mapml-copy-submenu")),L.DomEvent.on(o,"mouseover",this._onItemMouseOver,this).on(o,"mouseout",this._onItemMouseOut,this).on(o,"mousedown",L.DomEvent.stopPropagation).on(o,"click",n),L.Browser.touch&&L.DomEvent.on(o,this._touchstart,L.DomEvent.stopPropagation),L.Browser.pointer||L.DomEvent.on(o,"click",this._onItemMouseOut,this),{id:L.Util.stamp(o),el:o,callback:n}},_createSeparator:function(t,e){let i=this._insertElementAt("div","mapml-contextmenu-separator",t,e);return{id:L.Util.stamp(i),el:i}},_createEventHandler:function(t,e,i,o){let n=this;return o=void 0===o||o,function(a){let r=n._map,s=n._showLocation.containerPoint,l=r.containerPointToLayerPoint(s),m={containerPoint:s,layerPoint:l,latlng:r.layerPointToLatLng(l),relatedTarget:n._showLocation.relatedTarget};o&&n._hide(),e&&e.call(i||r,m),n._map.fire("contextmenu.select",{contextmenu:n,el:t})}},_insertElementAt:function(t,e,i,o){let n,a=document.createElement(t);return a.className=e,void 0!==o&&(n=i.children[o]),n?i.insertBefore(a,n):i.appendChild(a),a},_show:function(t){this._clickEvent=t,this._showAtPoint(t.containerPoint,t),0===t.originalEvent.button&&(this._keyboardEvent=!0,this._container.firstChild.focus())},_showAtPoint:function(t,e){if(this._items.length){let i=L.extend(e||{},{contextmenu:this});this._showLocation={containerPoint:t},e&&e.relatedTarget&&(this._showLocation.relatedTarget=e.relatedTarget),this._setPosition(t),this._visible||(this._container.style.display="block",this._visible=!0),this._map.fire("contextmenu.show",i)}},_hide:function(){this._visible&&(this._visible=!1,this._container.style.display="none",this._coordMenu.style.display="none",this._map.fire("contextmenu.hide",{contextmenu:this}))},_setPosition:function(t){let e,i=this._map.getSize(),o=this._container,n=this._getElementSize(o);this._map.options.contextmenuAnchor&&(e=L.point(this._map.options.contextmenuAnchor),t=t.add(e)),o._leaflet_pos=t,t.x+n.x>i.x?(o.style.left="auto",o.style.right=Math.min(Math.max(i.x-t.x,0),i.x-n.x-1)+"px"):(o.style.left=Math.max(t.x,0)+"px",o.style.right="auto"),t.y+n.y>i.y?(o.style.top="auto",o.style.bottom=Math.min(Math.max(i.y-t.y,0),i.y-n.y-1)+"px"):(o.style.top=Math.max(t.y,0)+"px",o.style.bottom="auto")},_getElementSize:function(t){let e=this._size,i=t.style.display;return e&&!this._sizeChanged||(e={},t.style.left="-999999px",t.style.right="auto",t.style.display="block",e.x=t.offsetWidth,e.y=t.offsetHeight,t.style.left="auto",t.style.display=i,this._sizeChanged=!1),e},_debounceKeyDown:function(t,e,i){let o,n=this,a=arguments;clearTimeout(o),o=setTimeout(function(){o=null,i||t.apply(n,a)},e),i&&!o&&t.apply(n,a)},_onKeyDown:function(t){this._visible&&this._debounceKeyDown(function(){switch(t.keyCode){case 32:this._map._container.parentNode.activeElement.parentNode.classList.contains("mapml-contextmenu")&&this._map._container.parentNode.activeElement.click();break;case 66:this._goBack(t);break;case 67:this._copyCoords({latlng:this._map.getCenter()});break;case 70:this._goForward(t);break;case 82:this._reload(t);break;case 84:this._toggleControls(t);break;case 86:this._viewSource(t);break;case 27:this._hide()}},250)},_showCoordMenu:function(t){let e=this._map.getSize(),i=this._clickEvent,o=this._coordMenu;this._items[5].el.el.setAttribute("aria-expanded","true"),o.style.display="block",i.containerPoint.x+150+80>e.x?(o.style.left="auto",o.style.right="150px"):(o.style.left="150px",o.style.right="auto"),i.containerPoint.y+150>e.y?(o.style.top="auto",o.style.bottom="20px"):(o.style.top="100px",o.style.bottom="auto"),this._keyboardEvent&&o.firstChild.focus()},_hideCoordMenu:function(t){if(t.srcElement.parentElement.classList.contains("mapml-submenu")||"Copy Coordinates (C) >"===t.srcElement.innerText)return;let e=this._coordMenu;this._items[5].el.el.setAttribute("aria-expanded","false"),e.style.display="none"},_onItemMouseOver:function(t){L.DomUtil.addClass(t.target||t.srcElement,"over"),"Copy Coordinates (C) >"===t.srcElement.innerText&&this._showCoordMenu(t)},_onItemMouseOut:function(t){L.DomUtil.removeClass(t.target||t.srcElement,"over"),this._hideCoordMenu(t)}}),T={convertAndFormatPCRS:function(t,e){if(!t||!e)return{};let i=[],o=[],n=[],a=[];for(let r=0;r<e.options.crs.options.resolutions.length;r++){let s=e.options.crs.scale(r),l=e.options.crs.transformation.transform(t.min,s),m=e.options.crs.transformation.transform(t.max,s);i.push({horizontal:l.x,vertical:m.y}),o.push({horizontal:m.x,vertical:l.y}),n.push({horizontal:i[r].horizontal/256,vertical:i[r].vertical/256}),a.push({horizontal:o[r].horizontal/256,vertical:o[r].vertical/256})}let r=e.options.crs.unproject(t.min),s=e.options.crs.unproject(t.max),l={topLeft:{horizontal:r.lng,vertical:s.lat},bottomRight:{horizontal:s.lng,vertical:r.lat}},m={topLeft:{horizontal:t.min.x,vertical:t.max.y},bottomRight:{horizontal:t.max.x,vertical:t.min.y}};return{topLeft:{tcrs:i,tilematrix:n,gcrs:l.topLeft,pcrs:m.topLeft},bottomRight:{tcrs:o,tilematrix:a,gcrs:l.bottomRight,pcrs:m.bottomRight},projection:e.options.projection}},extractInputBounds:function(t){if(!t)return;let i=t.values,o=t.projection||e,n=0,a="TILEMATRIX",r=this[o].options.crs.tilematrix.bounds(0),s=0,l=this[o].options.resolutions.length-1;t.zoomBounds||(t.zoomBounds={},t.zoomBounds.min=0,t.zoomBounds.max=l);for(let t=0;t<i.length;t++)switch(i[t].getAttribute("type")){case"zoom":s=+i[t].getAttribute("min"),l=+i[t].getAttribute("max"),n=+i[t].getAttribute("value");break;case"location":if(!i[t].getAttribute("max")||!i[t].getAttribute("min"))continue;let e=+i[t].getAttribute("max"),o=+i[t].getAttribute("min");switch(i[t].getAttribute("axis").toLowerCase()){case"x":case"longitude":case"column":case"easting":a=M.axisToCS(i[t].getAttribute("axis").toLowerCase()),r.min.x=o,r.max.x=e;break;case"y":case"latitude":case"row":case"northing":a=M.axisToCS(i[t].getAttribute("axis").toLowerCase()),r.min.y=o,r.max.y=e}}return{zoomBounds:{minZoom:+t.zoomBounds.min,maxZoom:+t.zoomBounds.max,minNativeZoom:s,maxNativeZoom:l},bounds:this.boundsToPCRSBounds(r,n,o,a)}},axisToCS:function(t){try{switch(t.toLowerCase()){case"row":case"column":return"TILEMATRIX";case"i":case"j":return["MAP","TILE"];case"x":case"y":return"TCRS";case"latitude":case"longitude":return"GCRS";case"northing":case"easting":return"PCRS";default:return"TILEMATRIX"}}catch(t){return}},boundsToPCRSBounds:function(e,i,o,n){if(e&&(i||0==+i)&&n)switch(n.toUpperCase()){case"TILEMATRIX":let a=L.bounds(L.point(e.min.x*t,e.min.y*t),L.point(e.max.x*t,e.max.y*t));return M.pixelToPCRSBounds(a,i,o);case"PCRS":return e;case"TCRS":return M.pixelToPCRSBounds(e,i,o);case"GCRS":let r=this[o].project(L.latLng(e.min.y,e.min.x)),s=this[o].project(L.latLng(e.max.y,e.max.x));return L.bounds(r,s);default:return}},pixelToPCRSBounds:function(t,e,i){if(!t||!t.max||!t.min||void 0===e||null===e||e instanceof Object)return;let o=this[i].transformation.untransform(t.min,this[i].scale(e)),n=this[i].transformation.untransform(t.max,this[i].scale(e));return L.bounds(o,n)},metaContentToObject:function(t){if(!t||t instanceof Object)return{};let e={},i=t.split(",");for(let t=0;t<i.length;t++){let o=i[t].split("=");2===o.length&&(e[o[0]]=o[1])}return""!==e&&1===i[0].split("=").length&&(e.content=i[0]),e},coordsToArray:function(t){for(var e=1,i=[],o=t.split(",");e<o.length;e+=2)i.push([parseInt(o[e-1]),parseInt(o[e])]);return i},parseStylesheetAsHTML:function(t,e,i){if(i instanceof Element&&t&&t.querySelector("link[rel=stylesheet],style")){if(e instanceof Element)e=e.getAttribute("href")?e.getAttribute("href"):document.URL;else if(!e||""===e||e instanceof Object)return;for(var o=[],n=t.querySelectorAll("link[rel=stylesheet],style"),a=0;a<n.length;a++)if("LINK"===n[a].nodeName.toUpperCase()){var r=n[a].hasAttribute("href")?new URL(n[a].getAttribute("href"),e).href:null;if(r&&!i.querySelector("link[href='"+r+"']")){var s=document.createElement("link");s.setAttribute("href",r),s.setAttribute("rel","stylesheet"),o.push(s)}}else{var l=document.createElement("style");l.textContent=n[a].textContent,o.push(l)}for(var m=o.length-1;m>=0;m--)i.insertAdjacentElement("afterbegin",o[m])}},splitCoordinate:function(t,e,i){var o=[];t.split(/\s+/gim).forEach(M.parseNumber,o),this.push(o)},parseNumber:function(t,e,i){this.push(parseFloat(t))}};!function(t,e,E){var A={};t.M=A,A.detectImagePath=function(t){var e=L.DomUtil.create("div","leaflet-default-icon-path",t),i=L.DomUtil.getStyle(e,"background-image")||L.DomUtil.getStyle(e,"backgroundImage");return t.removeChild(e),i=null===i||0!==i.indexOf("url")?"":i.replace(/^url\(["']?/,"").replace(/marker-icon\.png["']?\)$/,"")},A.mime="text/mapml",A.WGS84=new L.Proj.CRS("EPSG:4326","+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs ",{origin:[-180,90],bounds:L.bounds([[-180,-90],[180,90]]),resolutions:[.703125,.3515625,.17578125,.087890625,.0439453125,.02197265625,.010986328125,.0054931640625,.00274658203125,.001373291015625,.0006866455078125,.0003433227539062,.0001716613769531,858306884766e-16,429153442383e-16,214576721191e-16,107288360596e-16,53644180298e-16,26822090149e-16,13411045074e-16,6.705522537e-7,3.352761269e-7],crs:{tcrs:{horizontal:{name:"x",min:0,max:t=>(A.WGS84.options.bounds.getSize().x/A.WGS84.options.resolutions[t]).toFixed()},vertical:{name:"y",min:0,max:t=>(A.WGS84.options.bounds.getSize().y/A.WGS84.options.resolutions[t]).toFixed()},bounds:t=>L.bounds([A.WGS84.options.crs.tcrs.horizontal.min,A.WGS84.options.crs.tcrs.vertical.min],[A.WGS84.options.crs.tcrs.horizontal.max(t),A.WGS84.options.crs.tcrs.vertical.max(t)])},pcrs:{horizontal:{name:"longitude",get min(){return A.WGS84.options.crs.gcrs.horizontal.min},get max(){return A.WGS84.options.crs.gcrs.horizontal.max}},vertical:{name:"latitude",get min(){return A.WGS84.options.crs.gcrs.vertical.min},get max(){return A.WGS84.options.crs.gcrs.vertical.max}},get bounds(){return A.WGS84.options.bounds}},gcrs:{horizontal:{name:"longitude",min:-180,max:180},vertical:{name:"latitude",min:-90,max:90},get bounds(){return L.latLngBounds([A.WGS84.options.crs.gcrs.vertical.min,A.WGS84.options.crs.gcrs.horizontal.min],[A.WGS84.options.crs.gcrs.vertical.max,A.WGS84.options.crs.gcrs.horizontal.max])}},map:{horizontal:{name:"i",min:0,max:t=>t.getSize().x},vertical:{name:"j",min:0,max:t=>t.getSize().y},bounds:t=>L.bounds(L.point([0,0]),t.getSize())},tile:{horizontal:{name:"i",min:0,max:256},vertical:{name:"j",min:0,max:256},get bounds(){return L.bounds([A.WGS84.options.crs.tile.horizontal.min,A.WGS84.options.crs.tile.vertical.min],[A.WGS84.options.crs.tile.horizontal.max,A.WGS84.options.crs.tile.vertical.max])}},tilematrix:{horizontal:{name:"column",min:0,max:t=>(A.WGS84.options.crs.tcrs.horizontal.max(t)/A.WGS84.options.crs.tile.bounds.getSize().x).toFixed()},vertical:{name:"row",min:0,max:t=>(A.WGS84.options.crs.tcrs.vertical.max(t)/A.WGS84.options.crs.tile.bounds.getSize().y).toFixed()},bounds:t=>L.bounds([A.WGS84.options.crs.tilematrix.horizontal.min,A.WGS84.options.crs.tilematrix.vertical.min],[A.WGS84.options.crs.tilematrix.horizontal.max(t),A.WGS84.options.crs.tilematrix.vertical.max(t)])}}}),A.CBMTILE=new L.Proj.CRS("EPSG:3978","+proj=lcc +lat_1=49 +lat_2=77 +lat_0=49 +lon_0=-95 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs",{origin:[-34655800,3931e4],bounds:L.bounds([[-34655800,-39e6],[1e7,3931e4]]),resolutions:[38364.660062653464,22489.62831258996,13229.193125052918,7937.5158750317505,4630.2175937685215,2645.8386250105837,1587.5031750063501,926.0435187537042,529.1677250021168,317.50063500127004,185.20870375074085,111.12522225044451,66.1459656252646,38.36466006265346,22.48962831258996,13.229193125052918,7.9375158750317505,4.6302175937685215,2.6458386250105836,1.5875031750063502,.9260435187537043,.5291677250021167,.31750063500127,.18520870375074083,.11112522225044451,.06614596562526459],crs:{tcrs:{horizontal:{name:"x",min:0,max:t=>(A.CBMTILE.options.bounds.getSize().x/A.CBMTILE.options.resolutions[t]).toFixed()},vertical:{name:"y",min:0,max:t=>(A.CBMTILE.options.bounds.getSize().y/A.CBMTILE.options.resolutions[t]).toFixed()},bounds:t=>L.bounds([A.CBMTILE.options.crs.tcrs.horizontal.min,A.CBMTILE.options.crs.tcrs.vertical.min],[A.CBMTILE.options.crs.tcrs.horizontal.max(t),A.CBMTILE.options.crs.tcrs.vertical.max(t)])},pcrs:{horizontal:{name:"easting",get min(){return A.CBMTILE.options.bounds.min.x},get max(){return A.CBMTILE.options.bounds.max.x}},vertical:{name:"northing",get min(){return A.CBMTILE.options.bounds.min.y},get max(){return A.CBMTILE.options.bounds.max.y}},get bounds(){return A.CBMTILE.options.bounds}},gcrs:{horizontal:{name:"longitude",min:-141.01,max:-47.74},vertical:{name:"latitude",min:40.04,max:86.46},get bounds(){return L.latLngBounds([A.CBMTILE.options.crs.gcrs.vertical.min,A.CBMTILE.options.crs.gcrs.horizontal.min],[A.CBMTILE.options.crs.gcrs.vertical.max,A.CBMTILE.options.crs.gcrs.horizontal.max])}},map:{horizontal:{name:"i",min:0,max:t=>t.getSize().x},vertical:{name:"j",min:0,max:t=>t.getSize().y},bounds:t=>L.bounds(L.point([0,0]),t.getSize())},tile:{horizontal:{name:"i",min:0,max:256},vertical:{name:"j",min:0,max:256},get bounds(){return L.bounds([A.CBMTILE.options.crs.tile.horizontal.min,A.CBMTILE.options.crs.tile.vertical.min],[A.CBMTILE.options.crs.tile.horizontal.max,A.CBMTILE.options.crs.tile.vertical.max])}},tilematrix:{horizontal:{name:"column",min:0,max:t=>(A.CBMTILE.options.crs.tcrs.horizontal.max(t)/A.CBMTILE.options.crs.tile.bounds.getSize().x).toFixed()},vertical:{name:"row",min:0,max:t=>(A.CBMTILE.options.crs.tcrs.vertical.max(t)/A.CBMTILE.options.crs.tile.bounds.getSize().y).toFixed()},bounds:t=>L.bounds([0,0],[A.CBMTILE.options.crs.tilematrix.horizontal.max(t),A.CBMTILE.options.crs.tilematrix.vertical.max(t)])}}}),A.APSTILE=new L.Proj.CRS("EPSG:5936","+proj=stere +lat_0=90 +lat_ts=50 +lon_0=-150 +k=0.994 +x_0=2000000 +y_0=2000000 +datum=WGS84 +units=m +no_defs",{origin:[-28567784.109255,32567784.109255],bounds:L.bounds([[-28567784.109254867,-28567784.109254755],[32567784.109255023,32567784.10925506]]),resolutions:[238810.813354,119405.406677,59702.7033384999,29851.3516692501,14925.675834625,7462.83791731252,3731.41895865639,1865.70947932806,932.854739664032,466.427369832148,233.213684916074,116.606842458037,58.3034212288862,29.1517106145754,14.5758553072877,7.28792765351156,3.64396382688807,1.82198191331174,.910990956788164,.45549547826179],crs:{tcrs:{horizontal:{name:"x",min:0,max:t=>(A.APSTILE.options.bounds.getSize().x/A.APSTILE.options.resolutions[t]).toFixed()},vertical:{name:"y",min:0,max:t=>(A.APSTILE.options.bounds.getSize().y/A.APSTILE.options.resolutions[t]).toFixed()},bounds:t=>L.bounds([A.APSTILE.options.crs.tcrs.horizontal.min,A.APSTILE.options.crs.tcrs.vertical.min],[A.APSTILE.options.crs.tcrs.horizontal.max(t),A.APSTILE.options.crs.tcrs.vertical.max(t)])},pcrs:{horizontal:{name:"easting",get min(){return A.APSTILE.options.bounds.min.x},get max(){return A.APSTILE.options.bounds.max.x}},vertical:{name:"northing",get min(){return A.APSTILE.options.bounds.min.y},get max(){return A.APSTILE.options.bounds.max.y}},get bounds(){return A.APSTILE.options.bounds}},gcrs:{horizontal:{name:"longitude",min:-180,max:180},vertical:{name:"latitude",min:60,max:90},get bounds(){return L.latLngBounds([A.APSTILE.options.crs.gcrs.vertical.min,A.APSTILE.options.crs.gcrs.horizontal.min],[A.APSTILE.options.crs.gcrs.vertical.max,A.APSTILE.options.crs.gcrs.horizontal.max])}},map:{horizontal:{name:"i",min:0,max:t=>t.getSize().x},vertical:{name:"j",min:0,max:t=>t.getSize().y},bounds:t=>L.bounds(L.point([0,0]),t.getSize())},tile:{horizontal:{name:"i",min:0,max:256},vertical:{name:"j",min:0,max:256},get bounds(){return L.bounds([A.APSTILE.options.crs.tile.horizontal.min,A.APSTILE.options.crs.tile.vertical.min],[A.APSTILE.options.crs.tile.horizontal.max,A.APSTILE.options.crs.tile.vertical.max])}},tilematrix:{horizontal:{name:"column",min:0,max:t=>(A.APSTILE.options.crs.tcrs.horizontal.max(t)/A.APSTILE.options.crs.tile.bounds.getSize().x).toFixed()},vertical:{name:"row",min:0,max:t=>(A.APSTILE.options.crs.tcrs.vertical.max(t)/A.APSTILE.options.crs.tile.bounds.getSize().y).toFixed()},bounds:t=>L.bounds([0,0],[A.APSTILE.options.crs.tilematrix.horizontal.max(t),A.APSTILE.options.crs.tilematrix.vertical.max(t)])}}}),A.OSMTILE=L.CRS.EPSG3857,L.setOptions(A.OSMTILE,{origin:[-20037508.342787,20037508.342787],bounds:L.bounds([[-20037508.342787,-20037508.342787],[20037508.342787,20037508.342787]]),resolutions:[156543.0339,78271.51695,39135.758475,19567.8792375,9783.93961875,4891.969809375,2445.9849046875,1222.9924523438,611.49622617188,305.74811308594,152.87405654297,76.437028271484,38.218514135742,19.109257067871,9.5546285339355,4.7773142669678,2.3886571334839,1.1943285667419,.59716428337097,.29858214168549,.14929107084274,.074645535421371,.03732276771068573,.018661383855342866,.009330691927671433],crs:{tcrs:{horizontal:{name:"x",min:0,max:t=>(A.OSMTILE.options.bounds.getSize().x/A.OSMTILE.options.resolutions[t]).toFixed()},vertical:{name:"y",min:0,max:t=>(A.OSMTILE.options.bounds.getSize().y/A.OSMTILE.options.resolutions[t]).toFixed()},bounds:t=>L.bounds([A.OSMTILE.options.crs.tcrs.horizontal.min,A.OSMTILE.options.crs.tcrs.vertical.min],[A.OSMTILE.options.crs.tcrs.horizontal.max(t),A.OSMTILE.options.crs.tcrs.vertical.max(t)])},pcrs:{horizontal:{name:"easting",get min(){return A.OSMTILE.options.bounds.min.x},get max(){return A.OSMTILE.options.bounds.max.x}},vertical:{name:"northing",get min(){return A.OSMTILE.options.bounds.min.y},get max(){return A.OSMTILE.options.bounds.max.y}},get bounds(){return A.OSMTILE.options.bounds}},gcrs:{horizontal:{name:"longitude",get min(){return A.OSMTILE.unproject(A.OSMTILE.options.bounds.min).lng},get max(){return A.OSMTILE.unproject(A.OSMTILE.options.bounds.max).lng}},vertical:{name:"latitude",get min(){return A.OSMTILE.unproject(A.OSMTILE.options.bounds.min).lat},get max(){return A.OSMTILE.unproject(A.OSMTILE.options.bounds.max).lat}},get bounds(){return L.latLngBounds([A.OSMTILE.options.crs.gcrs.vertical.min,A.OSMTILE.options.crs.gcrs.horizontal.min],[A.OSMTILE.options.crs.gcrs.vertical.max,A.OSMTILE.options.crs.gcrs.horizontal.max])}},map:{horizontal:{name:"i",min:0,max:t=>t.getSize().x},vertical:{name:"j",min:0,max:t=>t.getSize().y},bounds:t=>L.bounds(L.point([0,0]),t.getSize())},tile:{horizontal:{name:"i",min:0,max:256},vertical:{name:"j",min:0,max:256},get bounds(){return L.bounds([A.OSMTILE.options.crs.tile.horizontal.min,A.OSMTILE.options.crs.tile.vertical.min],[A.OSMTILE.options.crs.tile.horizontal.max,A.OSMTILE.options.crs.tile.vertical.max])}},tilematrix:{horizontal:{name:"column",min:0,max:t=>(A.OSMTILE.options.crs.tcrs.horizontal.max(t)/A.OSMTILE.options.crs.tile.bounds.getSize().x).toFixed()},vertical:{name:"row",min:0,max:t=>(A.OSMTILE.options.crs.tcrs.vertical.max(t)/A.OSMTILE.options.crs.tile.bounds.getSize().y).toFixed()},bounds:t=>L.bounds([0,0],[A.OSMTILE.options.crs.tilematrix.horizontal.max(t),A.OSMTILE.options.crs.tilematrix.vertical.max(t)])}}}),A.convertAndFormatPCRS=T.convertAndFormatPCRS,A.axisToCS=T.axisToCS,A.parseNumber=T.parseNumber,A.extractInputBounds=T.extractInputBounds,A.splitCoordinate=T.splitCoordinate,A.boundsToPCRSBounds=T.boundsToPCRSBounds,A.pixelToPCRSBounds=T.pixelToPCRSBounds,A.metaContentToObject=T.metaContentToObject,A.coordsToArray=T.coordsToArray,A.parseStylesheetAsHTML=T.parseStylesheetAsHTML,A.QueryHandler=b,A.ContextMenu=v,L.Map.addInitHook("addHandler","query",A.QueryHandler),L.Map.addInitHook("addHandler","contextMenu",A.ContextMenu),A.MapMLLayer=_,A.mapMLLayer=f,A.ImageOverlay=y,A.imageOverlay=x,A.TemplatedImageLayer=d,A.templatedImageLayer=g,A.TemplatedFeaturesLayer=h,A.templatedFeaturesLayer=p,A.TemplatedLayer=u,A.templatedLayer=c,A.TemplatedTileLayer=l,A.templatedTileLayer=m,A.MapMLFeatures=r,A.mapMlFeatures=s,A.MapMLLayerControl=n,A.mapMlLayerControl=a,A.MapMLStaticTileLayer=i,A.mapMLStaticTileLayer=o}(window)}();